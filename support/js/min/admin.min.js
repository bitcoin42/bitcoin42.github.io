"use strict";!function(t){function e(t,e){var i=f.find(".sb-info-card");SBF.null(e)?(i.removeClass("sb-info-card-error sb-info-card-warning sb-info-card-info"),clearTimeout(P),P=setTimeout(()=>{i.sbActive(!1)},5e3)):SBF.null(e)||"error"!=e?i.addClass("sb-info-card-info"):i.addClass("sb-info-card-error"),i.html(`<h3>${o(t)}</h3>`).sbActive(!0)}function i(t){if(typeof t==dt)return window.sb_current_user;window.sb_current_user=t}function a(e,i,a=!1,s="",n="",r=!1){let l=f.find(".sb-dialog-box").attr("data-type",i),c=l.find("p");l.attr("id",s).setClass("sb-scroll-area",r).css("height",r?parseInt(t(window).height())-200+"px":""),l.find(".sb-title").html(n),c.html(("alert"==i?o("Are you sure?")+" ":"")+o(e)),l.sbActive(!0).css({"margin-top":l.outerHeight()/-2+"px","margin-left":l.outerWidth()/-2+"px"}),q.sbActive(!0),O=a,setTimeout(()=>{mt.open_popup=l},500)}function s(e=!0,i=!0){f.find(".sb-loading-global").sbActive(e),i&&(q.sbActive(e),t("body").setClass("sb-lightbox-active",e))}function n(e){return!!t(e).sbLoading()||(t(e).sbLoading(!0),!1)}function o(t){return SB_TRANSLATIONS&&t in SB_TRANSLATIONS?SB_TRANSLATIONS[t]:t}function r(){typeof caches!==dt&&caches.delete("sb-pwa-cache")}function l(e,i){let a=(e=t(e)).find(" > div, > ul");a.css({height:"","max-height":""}),e.hasClass("sb-collapse")&&t(a).prop("scrollHeight")>i&&(e.sbActive(!0).attr("data-height",i),e.find(".sb-collapse-btn").remove(),e.append(`<a class="sb-btn-text sb-collapse-btn">${o("View more")}</a>`),a.css({height:i+"px","max-height":i+"px"}))}function c(e,i){let a=t(e).parent().find("i"),s=t(e).val();a.sbLoading()||SBF.search(s,()=>{a.sbLoading(!0),i(s,a)})}function d(e,i=!1,a=0){if(i)return t(e).scrollTop()+t(e).innerHeight()>=t(e)[0].scrollHeight-1;t(e).scrollTop(t(e)[0].scrollHeight-a)}function u(t){ut||window.history.pushState("","",t)}function p(){return SB_ADMIN_SETTINGS.cloud?"&cloud="+SB_ADMIN_SETTINGS.cloud.token:""}function h(){SBF.ajax({function:"get-conversations",routing:SB_ADMIN_SETTINGS.routing,routing_unassigned:SB_ADMIN_SETTINGS["assign-conversation-to-agent"]},t=>{0==t.length&&b.find(".sb-board").addClass("sb-no-conversation"),bt.populateList(t),at&&b.find(".sb-admin-list").sbActive(!0),SBF.getURL("conversation")?(b.sbActive()||g.find(".sb-admin-nav #sb-conversations").click(),bt.openConversation(SBF.getURL("conversation"))):at||SBF.getURL("user")||SBF.getURL("setting")||SBF.getURL("report")||SBF.getURL("area")&&"conversations"!=SBF.getURL("area")||bt.clickFirst(),bt.startRealTime(),bt.datetime_last_conversation=SB_ADMIN_SETTINGS["now-db"],s(!1)}),SBPusher.initServiceWorker(),SB_ADMIN_SETTINGS["push-notifications"]&&SBPusher.initPushNotifications()}var f,g,b,v,m,S,_,B,y,w,x,k,A,C,T,$,F,I,L,E,N,M,R,D,U,G,j,P,O,V,H,q,W,J=[],z=!1,X=!1,Y=!1,K=!1,Q=1,Z=1,tt={},et=1,it=1,at=t(window).width()<429,st={last:0,header:!0,always_hidden:!1},nt="localhost"===location.hostname||"127.0.0.1"===location.hostname,ot=new Date,rt=!1,lt=!0,ct=!1,dt="undefined",ut=!1;t.fn.miniTip=function(e){var i=t.extend({title:"",content:!1,delay:300,anchor:"n",event:"hover",fadeIn:200,fadeOut:200,aHide:!0,maxW:"250px",offset:5,stemOff:0,doHide:!1},e);0==f.find("#miniTip").length&&f.append('<div id="miniTip" class="sb-tooltip"><div></div></div>');var a=f.find("#miniTip"),s=a.find("div");return i.doHide?(a.stop(!0,!0).fadeOut(i.fadeOut),!1):this.each(function(){var e=t(this),n=i.content?i.content:e.attr("title");if(""!=n&&void 0!==n){window.delay=!1;var o=!1,r=!0;i.content||e.removeAttr("title"),"hover"==i.event?(e.hover(function(){a.removeAttr("click"),r=!0,l.call(this)},function(){r=!1,c()}),i.aHide||a.hover(function(){o=!0},function(){o=!1,setTimeout(function(){!r&&!a.attr("click")&&c()},20)})):"click"==i.event&&(i.aHide=!0,e.click(function(){return a.attr("click","t"),a.data("last_target")!==e?l.call(this):"none"==a.css("display")?l.call(this):c(),a.data("last_target",e),t("html").unbind("click").click(function(e){"block"==a.css("display")&&!t(e.target).closest("#miniTip").length&&(t("html").unbind("click"),c())}),!1}));var l=function(){i.show&&i.show.call(this,i),i.content&&""!=i.content&&(n=i.content),s.html(n),i.render&&i.render(a),a.hide().width("").width(a.width()).css("max-width",i.maxW);var o=e.is("area");if(o){var r,l=[],c=[],d=e.attr("coords").split(",");function u(t,e){return t-e}for(r=0;r<d.length;r++)l.push(d[r++]),c.push(d[r]);var p=e.parent().attr("name"),h=t("img[usemap=\\#"+p+"]").offset(),f=parseInt(h.left,10)+parseInt((parseInt(l.sort(u)[0],10)+parseInt(l.sort(u)[l.length-1],10))/2,10),g=parseInt(h.top,10)+parseInt((parseInt(c.sort(u)[0],10)+parseInt(c.sort(u)[c.length-1],10))/2,10)}else g=parseInt(e.offset().top,10),f=parseInt(e.offset().left,10);var b=o?0:parseInt(e.outerWidth(),10),v=o?0:parseInt(e.outerHeight(),10),m=a.outerWidth(),S=a.outerHeight(),_=Math.round(f+Math.round((b-m)/2)),B=Math.round(g+v+i.offset+8),y=Math.round(m-16)/2-parseInt(a.css("borderLeftWidth"),10),w=0,x=f+b+m+i.offset+8>parseInt(t(window).width(),10),k=m+i.offset+8>f,A=S+i.offset+8>g-t(window).scrollTop(),C=g+v+S+i.offset+8>parseInt(t(window).height()+t(window).scrollTop(),10),T=i.anchor;k||"e"==i.anchor&&!x?"w"!=i.anchor&&"e"!=i.anchor||(T="e",w=Math.round(S/2-8-parseInt(a.css("borderRightWidth"),10)),y=-8-parseInt(a.css("borderRightWidth"),10),_=f+b+i.offset+8,B=Math.round(g+v/2-S/2)):(x||"w"==i.anchor&&!k)&&("w"!=i.anchor&&"e"!=i.anchor||(T="w",w=Math.round(S/2-8-parseInt(a.css("borderLeftWidth"),10)),y=m-parseInt(a.css("borderLeftWidth"),10),_=f-m-i.offset-8,B=Math.round(g+v/2-S/2))),C||"n"==i.anchor&&!A?"n"!=i.anchor&&"s"!=i.anchor||(T="n",w=S-parseInt(a.css("borderTopWidth"),10),B=g-(S+i.offset+8)):(A||"s"==i.anchor&&!C)&&("n"!=i.anchor&&"s"!=i.anchor||(T="s",w=-8-parseInt(a.css("borderBottomWidth"),10),B=g+v+i.offset+8)),"n"==i.anchor||"s"==i.anchor?m/2>f?(_=_<0?y+_:y,y=0):f+m/2>parseInt(t(window).width(),10)&&(_-=y,y*=2):A?(B+=w,w=0):C&&(B-=w,w*=2),delay&&clearTimeout(delay),delay=setTimeout(function(){a.css({"margin-left":_+"px","margin-top":B+"px"}).stop(!0,!0).fadeIn(i.fadeIn)},i.delay),a.attr("class","sb-tooltip "+T)},c=function(){(!i.aHide&&!o||i.aHide)&&(delay&&clearTimeout(delay),delay=setTimeout(function(){d()},i.delay))},d=function(){!i.aHide&&!o||i.aHide?(a.stop(!0,!0).fadeOut(i.fadeOut),i.hide&&i.hide.call(this)):setTimeout(function(){c()},200)}}})},t.fn.sbLanguageSwitcher=function(e=[],i="",a=!1){let s=`<div class="sb-language-switcher" data-source="${i}">`,n=[],r=t(this).hasClass("sb-language-switcher-cnt")?t(this):t(this).find(".sb-language-switcher-cnt");for(var l=0;l<e.length;l++)n.includes(e[l])||(s+=`<span ${a==e[l]?'class="sb-active" ':""}data-language="${e[l]}"><i class="sb-icon-close"></i><img src="${SB_URL}/media/flags/${e[l].toLowerCase()}.png" /></span>`,n.push(e[l]));return r.find(".sb-language-switcher").remove(),r.append(s+`<i data-sb-tooltip="${o("Add translation")}" class="sb-icon-plus"></i></div>`),r.sbInitTooltips(),this},t.fn.sbShowLightbox=function(e=!1,i=""){return f.find(".sb-lightbox").sbActive(!1),q.sbActive(!0),t(this).sbActive(!0),e?t(this).addClass("sb-popup-lightbox").attr("data-action",i):t(this).css({"margin-top":t(this).outerHeight()/-2+"px","margin-left":t(this).outerWidth()/-2+"px"}),t("body").addClass("sb-lightbox-active"),setTimeout(()=>{mt.open_popup=this},500),this.preventDefault,this},t.fn.sbHideLightbox=function(){return t(this).find(".sb-lightbox,.sb-popup-lightbox").sbActive(!1).removeClass("sb-popup-lightbox").removeAttr("data-action"),q.sbActive(!1),t("body").removeClass("sb-lightbox-active"),mt.open_popup=!1,this},t.fn.sbInitTooltips=function(){return t(this).find("[data-sb-tooltip]").each(function(){t(this).miniTip({content:t(this).attr("data-sb-tooltip"),anchor:"s",delay:500})}),this};var pt={dialogflow:{intents:!1,token:SBF.storage("dialogflow-token"),smart_reply_data:!1,smartReply:function(t){SBF.ajax({function:"dialogflow-smart-reply",message:t,smart_reply_data:this.smart_reply_data?this.smart_reply_data:{conversation_id:SBChat.conversation.id},token:this.token,dialogflow_language:[i().language?i().language:"en"],language_detection:SB_ADMIN_SETTINGS["smart-reply-language-detection"]&&SBChat.conversation&&!SBChat.conversation.getLastUserMessage(!1,!0)&&(!SB_ADMIN_SETTINGS["smart-reply-language-detection-bot"]||!SBChat.conversation.getLastUserMessage(!1,"bot"))},t=>{let e=t.suggestions,i="",a=b.find(".sb-conversation .sb-list"),s=a[0].scrollTop===a[0].scrollHeight-a[0].offsetHeight,n=!(!SBChat.conversation||!SBChat.conversation.getLastMessage())&&SBChat.conversation.getLastMessage().message;t.token&&this.token!=t.token&&(this.token=t.token,SBF.storage("dialogflow-token",t.token));for(var o=0;o<e.length;o++)e[o]!=n&&(i+=`<span>${e[o]}</span>`);this.smart_reply_data=t.smart_reply,w.html(i),s&&SBChat.scrollBottom()})},smartReplyUpdate:function(t,e="agent"){SBF.ajax({function:"dialogflow-smart-reply-update",message:t,smart_reply_data:this.smart_reply_data?this.smart_reply_data:{conversation_id:SBChat.conversation.id},token:this.token,dialogflow_language:[i().language],user_type:e})},showCreateIntentBox:function(t){let e="",i=SBChat.conversation.getMessage(t),a=i.message;if(SBF.isAgent(i.get("user_type")))(e=SBChat.conversation.getLastUserMessage(i.get("index")))&&e.payload("sb-human-takeover")&&(e=SBChat.conversation.getLastUserMessage(e.get("index"))),e=0==e?"":e.message;else{e=a;let t=SBChat.conversation.messages;for(var s=i.get("index");s<t.length;s++)if(["agent","admin"].includes(t[s].get("user_type"))){a=t[s].message;break}}!1===this.intents&&SBF.ajax({function:"dialogflow-get-intents"},t=>{let e="";if(Array.isArray(t)){for(var i=0;i<t.length;i++)e+=`<option value="${t[i].name}">${t[i].displayName}</option>`;y.find("#sb-intents-select").append(e),this.intents=t}else this.intents=[]}),y.attr("data-message-id",i.id),y.find(".sb-type-text:not(.sb-first)").remove(),y.find(".sb-type-text input").val(e),y.find("textarea").val(a),y.find("#sb-intents-select").val(""),y.find(".sb-search-btn").sbActive(!1).find("input").val(""),this.searchIntents(""),y.sbShowLightbox()},submitIntent:function(i){if(n(i))return;let a=[],s=y.find("textarea").val(),o=y.find("#sb-intents-select").val();y.find(".sb-type-text input").each(function(){t(this).val()&&a.push(t(this).val())}),""==s&&!o||0==a.length?(SBForm.showErrorMessage(y,"Please insert the bot response and at least one user expression."),t(i).sbLoading(!1)):SBF.ajax({function:""==o?"dialogflow-create-intent":"dialogflow-update-intent",expressions:a,response:s,agent_language:y.find(".sb-dialogflow-languages select").val(),conversation_id:SBChat.conversation.id,intent_name:o},a=>{if(t(i).sbLoading(!1),!0===a)f.sbHideLightbox(),e(""==o?"Intent created":"Intent updated");else{let t="Error";"error"in a&&"message"in a.error&&(t=a.error.message),SBForm.showErrorMessage(y,t)}})},searchIntents:function(t){t=t.toLowerCase(),SBF.search(t,()=>{let e=!(t.length>1),i=e?`<option value="">${o("New Intent")}</option>`:"",a=this.intents;for(var s=0;s<a.length;s++){let o=e||a[s].displayName.toLowerCase().includes(t);if(!o&&"trainingPhrases"in a[s]){let e=a[s].trainingPhrases;for(var n=0;n<e.length;n++){for(var r=0;r<e[n].parts.length;r++)if(e[n].parts[r].text.toLowerCase().includes(t)){o=!0;break}if(o)break}}o&&(i+=`<option value="${a[s].name}">${a[s].displayName}</option>`)}y.find("#sb-intents-select").html(i)})},previewIntent:function(t){let e="";for(var i=0;i<this.intents.length;i++)if(this.intents[i].name==t){let t="trainingPhrases"in this.intents[i]?this.intents[i].trainingPhrases:[],o=t.length;if(o>1){for(var s=0;s<o;s++)for(var n=0;n<t[s].parts.length&&(e+=`<span>${t[s].parts[n].text}</span>`,15!=n);n++);a(e,"info",!1,"intent-preview-box","",o>10)}break}},translate:function(t,e,i){t.length&&SBF.ajax({function:"google-translate",strings:t,language_code:e,token:this.token},t=>{if(this.token=t[1],!("data"in t[0]&&"translations"in t[0].data))return SBF.error(JSON.stringify(t[0]),"SBApps.dialogflow.translate"),!1;i(t[0].data.translations)})}},messenger:{check:function(t){return["fb","ig"].includes(t.get("source"))},send:function(t,e,i="",a=[],s,n=!1){SBF.ajax({function:"messenger-send-message",psid:t,facebook_page_id:e,message:i,attachments:a,metadata:s},t=>{n&&n(t)})}},whatsapp:{check:function(t){return"wa"==t.get("source")},send:function(t,e="",i=[],a=!1){SBF.ajax({function:"whatsapp-send-message",to:t,message:e,attachments:i},t=>{a&&a(t)})},activeUserPhone:function(){return!!i().getExtra("phone")&&i().getExtra("phone").value.replace("+","")}},telegram:{check:function(t){return"tg"==t.get("source")},send:function(t,e="",i=[],a=!1){SBF.ajax({function:"telegram-send-message",chat_id:t,message:e,attachments:i},t=>{a&&a(t)})}},wechat:{token:!1,check:function(t){return"wc"==t.get("source")},send:function(t,e="",i=[],a=!1){SBF.ajax({function:"wechat-send-message",open_id:t,message:e,attachments:i,token:this.token},t=>{Array.isArray(t)&&(this.token=t[1],t=t[0]),a&&a(t)})}},aecommerce:{panel:!1,conversationPanel:function(){let e="",a=i().getExtra("aecommerce-id");this.panel||(this.panel=b.find(".sb-panel-aecommerce")),a&&!n(this.panel)&&SBF.ajax({function:"aecommerce-get-conversation-details",aecommerce_id:a.value},i=>{e=`<h3>${SB_ADMIN_SETTINGS["aecommerce-panel-title"]}</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of orders")}</div><span>${i.orders_count} ${o("orders")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.currency_symbol}${i.total}</span></div></div><div class="sb-title">${o("Cart")}</div><div class="sb-list-items sb-list-links sb-aecommerce-cart">`;for(a=0;a<i.cart.length;a++){let t=i.cart[a];e+=`<a href="${t.url}" target="_blank" data-id="${t.id}"><span>#${t.id}</span> <span>${t.name}</span> <span>x ${t.quantity}</span></a>`}if(e+=(i.cart.length?"":"<p>"+o("The cart is currently empty.")+"</p>")+"</div>",i.orders.length){e+=`<div class="sb-title">${o("Orders")}</div><div class="sb-list-items sb-list-links sb-aecommerce-orders">`;for(var a=0;a<i.orders.length;a++){let t=i.orders[a],s=t.id;e+=`<a data-id="${s}" href="${t.url}" target="_blank"><span>#${t.id}</span> <span>${SBF.beautifyTime(t.time,!0)}</span> <span>${i.currency_symbol}${t.price}</span></a>`}e+="</div>"}t(this.panel).html(e).sbLoading(!1),l(this.panel,160)}),t(this.panel).html(e)}},whmcs:{panel:!1,conversationPanel:function(){let e="",a=i().getExtra("whmcs-id");this.panel||(this.panel=b.find(".sb-panel-whmcs")),a&&!n(this.panel)&&SBF.ajax({function:"whmcs-get-conversation-details",whmcs_id:a.value},i=>{let a=["products","addons","domains"];e=`<h3>WHMCS</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of services")}</div><span>${i.services_count} ${o("services")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.currency_symbol}${i.total}</span></div></div>`,e+="</div>";for(var s=0;s<a.length;s++){let t=i[a[s]];if(t.length){e+=`<div class="sb-title">${o(SBF.slugToString(a[s]))}</div><div class="sb-list-items">`;for(var n=0;n<t.length;n++)e+=`<div>${t[n].name}</div>`;e+="</div>"}}e+=`<a href="${SB_ADMIN_SETTINGS["whmcs-url"]}/clientssummary.php?userid=${i["client-id"]}" target="_blank" class="sb-btn sb-whmcs-link">${o("View on WHMCS")}</a>`,t(this.panel).html(e).sbLoading(!1),l(this.panel,160)}),t(this.panel).html(e)}},perfex:{conversationPanel:function(){let t=i().getExtra("perfex-id");b.find(".sb-panel-perfex").html(""==t?"":`<a href="${SB_ADMIN_SETTINGS["perfex-url"]}/admin/clients/client/${t.value}" target="_blank" class="sb-btn sb-perfex-link">${o("View on Perfex")}</a>`)}},ump:{panel:!1,conversationPanel:function(){if(n(this.panel))return;this.panel||(this.panel=b.find(".sb-panel-ump"));let e,i="";SBF.ajax({function:"ump-get-conversation-details"},a=>{if((e=a.subscriptions).length){i='<i class="sb-icon-refresh"></i><h3>Membership</h3><div class="sb-list-names">';for(var s=0;s<e.length;s++){let t=e[s].expired;i+=`<div${t?' class="sb-expired"':""}><span>${e[s].label}</span><span>${o(t?"Expired on":"Expires on")} ${SBF.beautifyTime(e[s].expire_time,!1,!t)}</span></div>`}i+=`</div><span class="sb-title">${o("Total spend")} ${a.currency_symbol}${a.total}</span>`}t(this.panel).html(i).sbLoading(!1),l(this.panel,160)})}},armember:{panel:!1,conversationPanel:function(){let e=i().getExtra("wp-id");if(this.panel||(this.panel=b.find(".sb-panel-armember")),SBF.null(e)||n(this.panel))t(this.panel).html("");else{let a,s="";e=e.value,SBF.ajax({function:"armember-get-conversation-details",wp_user_id:e},e=>{if((a=e.subscriptions).length){s='<i class="sb-icon-refresh"></i><h3>Plans</h3><div class="sb-list-names">';for(var n=0;n<a.length;n++){let t=a[n].expired;s+=`<div${t?' class="sb-expired"':""}><span>${a[n].arm_current_plan_detail.arm_subscription_plan_name}</span><span>${"never"==a[n].expire_time?"":o(t?"Expired on":"Expires on")+" "+SBF.beautifyTime(a[n].expire_time,!1,!t)}</span></div>`}s+=`</div><span class="sb-title">${o("Total spend")} ${e.currency_symbol}${e.total}<a href="${window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"?page=arm_manage_members&member_id="+i().getExtra("wp-id").value}" target="_blank" class="sb-btn-text"><i class="sb-icon-user"></i> ${o("View member")}</a></span>`}t(this.panel).html(s).sbLoading(!1),l(this.panel,160)})}}},woocommerce:{popupPaginationNumber:1,popupLanguage:"",popupCache:[],panel:!1,timeout:!1,popupCode:function(t,e=!0){let i="";for(var a=0;a<t.length;a++)i+=`<li data-id="${t[a].id}"><div class="sb-image" style="background-image:url('${t[a].image}')"></div><div><span>${t[a].name}</span><span>${SB_ADMIN_SETTINGS.currency}${t[a].price}</span></div></li>`;return e&&""==i?`<p>${o("No products found")}</p>`:i},popupSearch:function(e){c(e,(e,i)=>{""==e?this.popupPopulate(function(){t(i).sbLoading(!1)}):(this.popupPaginationNumber=1,SBF.ajax({function:"woocommerce-search-products",search:e},e=>{K.html(this.popupCode(e)),t(i).sbLoading(!1)}))})},popupFilter:function(e){n(K)||(K.html(""),this.popupPaginationNumber=1,SBF.ajax({function:"woocommerce-get-products",user_language:this.popupLanguage,filters:{taxonomy:t(e).data("value")}},t=>{K.html(this.popupCode(t)).sbLoading(!1)}))},popupPopulate:function(t=!1){this.popupLanguage=0!=i()&&SB_ADMIN_SETTINGS.languages.includes(i().language)?i().language:"",this.popupPaginationNumber=1,K.html("").sbLoading(!0),SBF.ajax({function:"woocommerce-products-popup",user_language:this.popupLanguage},e=>{let i="",a=Y.find(".sb-select");for(var s=0;s<e[1].length;s++)i+=`<li data-value="${e[1][s].id}">${e[1][s].name}</li>`;a.find("> p").html(o("All")),a.find("ul").html(`<li data-value="" class="sb-active">${o("All")}</li>`+i),K.html(this.popupCode(e[0])).sbLoading(!1),!1!==t&&t()})},popupPagination:function(e){K.sbLoading(e),SBF.ajax({function:"woocommerce-get-products",filters:{taxonomy:t(e).parent().find(".sb-select p").attr("data-value")},pagination:this.popupPaginationNumber,user_language:this.popupLanguage},t=>{K.append(this.popupCode(t,!1)).sbLoading(!1),this.popupPaginationNumber++,d(e)})},conversationPanel:function(){if(n(this.panel))return;this.panel||(this.panel=b.find(".sb-panel-woocommerce"));let e="";SBF.ajax({function:"woocommerce-get-conversation-details"},i=>{e=`<i class="sb-icon-refresh"></i><h3>WooCommerce</h3><div><div class="sb-split"><div><div class="sb-title">${o("Number of orders")}</div><span>${i.orders_count} ${o("orders")}</span></div><div><div class="sb-title">${o("Total spend")}</div><span>${i.currency_symbol}${i.total}</span></div></div><div class="sb-title">${o("Cart")}<i class="sb-add-cart-btn sb-icon-plus"></i></div><div class="sb-list-items sb-list-links sb-woocommerce-cart">`;for(a=0;a<i.cart.length;a++){let t=i.cart[a];e+=`<a href="${t.url}" target="_blank" data-id="${t.id}"><span>#${t.id}</span> <span>${t.name}</span> <span>x ${t.quantity}</span><i class="sb-icon-close"></i></a>`}if(e+=(i.cart.length?"":"<p>"+o("The cart is currently empty.")+"</p>")+"</div>",i.orders.length){e+=`<div class="sb-title">${o("Orders")}</div><div class="sb-list-items sb-woocommerce-orders sb-accordion">`;for(var a=0;a<i.orders.length;a++){let t=i.orders[a],s=t.id;e+=`<div data-id="${s}"><span><span>#${s}</span> <span>${SBF.beautifyTime(t.date,!0)}</span><a href="${W}/wp-admin/post.php?post=${s}&action=edit" target="_blank" class="sb-icon-next"></a></span><div></div></div>`}e+="</div>"}t(this.panel).html(e).sbLoading(!1),l(this.panel,160)})},conversationPanelOrder:function(t){let e=this.panel.find(`[data-id="${t}"] > div`);e.html(""),SBF.ajax({function:"woocommerce-get-order",order_id:t},t=>{let i="",a=this.panel.find(".sb-collapse-btn:not(.sb-active)");if(t){let e=t.products;i+=`<div class="sb-title">${o("Order total")}: <span>${t.currency_symbol}${t.total}<span></div><div class="sb-title">${o("Order status")}: <span>${SBF.slugToString(t.status.replace("wc-",""))}<span></div><div class="sb-title">${o("Date")}: <span>${SBF.beautifyTime(t.date,!0)}<span></div><div class="sb-title">${o("Products")}</div>`;for(s=0;s<e.length;s++)i+=`<a href="${W}?p=${e[s].id}" target="_blank"><span>#${e[s].id}</span> <span>${e[s].quantity} x</span> <span>${e[s].name}</span></a>`;for(var s=0;s<2;s++){let e=0==s?"shipping":"billing";t[e+"_address"]&&(i+=`<div class="sb-title">${o((0==s?"Shipping":"Billing")+" address")}</div><div class="sb-multiline">${t[e+"_address"].replace(/\\n/g,"<br>")}</div>`)}}a.length&&a.click(),e.html(i)})},conversationPanelUpdate:function(t,e="added"){let i=!1,a=0;this.timeout=setInterval(()=>{i||(SBF.ajax({function:"woocommerce-get-conversation-details"},s=>{let n=!0;for(var o=0;o<s.cart.length;o++)s.cart[o].id==t&&("added"==e?a=61:n=!1);(a>60||n)&&(this.conversationPanel(),b.find(".sb-add-cart-btn,.sb-woocommerce-cart > a i").sbLoading(!1),clearInterval(this.timeout)),a++,i=!1}),i=!0)},1e3)}},wordpress:{ajax:function(e,i,a){t.ajax({method:"POST",url:SB_WP_AJAX_URL,data:t.extend({action:"sb_wp_ajax",type:e},i)}).done(t=>{!1!==a&&a(t)})}},is:function(t){if(typeof SB_VERSIONS==dt)return!1;switch(t){case"wechat":case"telegram":case"armember":case"aecommerce":case"whmcs":case"perfex":case"ump":case"messenger":case"whatsapp":case"woocommerce":case"dialogflow":case"slack":case"tickets":return typeof SB_VERSIONS[t]!=dt&&-1!=SB_VERSIONS[t];case"wordpress":return typeof SB_WP!=dt;case"sb":return!0}return!1}},ht={init:!1,save:function(i){if(n(i))return;let a={},s={};switch($.find(" > .sb-tab > .sb-nav .sb-active").attr("id")){case"tab-articles":this.articles.save(a=>{e(!0===a?"Articles and categories saved":a),t(i).sbLoading(!1)});break;case"tab-automations":let n=M.find(".sb-active").attr("data-id");ht.automations.save(a=>{e(!0===a?"Automations saved":a),ht.automations.populate(),M.find(`[data-id="${n}"]`).click(),t(i).sbLoading(!1)});break;case"tab-translations":this.translations.updateActive(),SBF.ajax({function:"save-translations",translations:JSON.stringify(this.translations.to_update)},()=>{e("Translations saved"),t(i).sbLoading(!1)});break;default:$.find(".sb-setting").each((e,i)=>{let n=this.get(i),o=t(i).data("setting");if(n[0])if(typeof o!=dt){let e=!1;if(t(i).find("[data-language]").length){let a=t(i).find("[data-language].sb-active");if(e=n[0]in this.translations.originals&&this.translations.originals[n[0]],this.translations.save(i,!!a.length&&a.attr("data-language")),e&&"string"!=typeof e)for(var r in e)e[r]=[e[r],n[1][r][1]]}o in a||(a[o]={}),a[o][n[0]]=[e||n[1],n[2]]}else s[n[0]]=[n[1],n[2]]}),SBF.ajax({function:"save-settings",settings:s,external_settings:a,external_settings_translations:this.translations.translations},()=>{e("Settings saved"),t(i).sbLoading(!1)})}},initPlugins:function(){$.find("textarea").each(function(){t(this).autoExpandTextarea(),t(this).manualExpandTextarea()}),$.find("[data-setting] .sb-language-switcher-cnt").each(function(){t(this).sbLanguageSwitcher(ht.translations.getLanguageCodes(t(this).closest("[data-setting]").attr("id")),"settings")})},initColorPicker:function(e=!1){t(e||$).find(".sb-type-color input").colorPicker({renderCallback:function(e,i){t(e.context).closest(".input").find("input").css("background-color",e.text)}})},initHTML:function(t){if("slack-agents"in t){let i="";for(var e in t["slack-agents"][0])i+=`<div data-id="${e}"><select><option value="${t["slack-agents"][0][e]}"></option></select></div>`;$.find("#slack-agents .input").html(i)}},get:function(e){let i=(e=t(e)).attr("id"),a=e.data("type");switch(a){case"upload":case"range":case"number":case"text":case"password":case"color":return[i,e.find("input").val(),a];case"textarea":return[i,e.find("textarea").val(),a];case"select":return[i,e.find("select").val(),a];case"checkbox":return[i,e.find("input").is(":checked"),a];case"radio":let s=e.find("input:checked").val();return SBF.null(s)&&(s=""),[i,s,a];case"upload-image":let n=e.find(".image").attr("data-value");return SBF.null(n)&&(n=""),[i,n,a];case"multi-input":let o={};return e.find(".input > div").each((t,e)=>{let i=this.get(e);i[0]&&(o[i[0]]=[i[1],i[2]])}),[i,o,a];case"select-images":return[i,e.find(".input > .sb-active").data("value"),a];case"repeater":return[i,this.repeater("get",e.find(".repeater-item"),""),a];case"double-select":let r={};return e.find(".input > div").each(function(){let e=t(this).find("select").val();-1!=e&&(r[t(this).attr("data-id")]=[e])}),[i,r,a];case"timetable":let l={};return e.find(".sb-timetable > [data-day]").each(function(){let e=t(this).attr("data-day"),i=[];t(this).find("> div > div").each(function(){let e=t(this).html(),a=t(this).attr("data-value");SBF.null(a)?i.push(["",""]):"closed"==a?i.push(["closed","Closed"]):i.push([a,e])}),l[e]=i}),[i,l,a];case"color-palette":return[i,e.attr("data-value"),a]}return["","",""]},set:function(e,i){let a=t(i)[1],s=t(i)[0];switch(e=`#${e}`,a){case"color":case"upload":case"number":case"text":case"password":$.find(`${e} input`).val(SBF.restoreJson(s));break;case"textarea":$.find(`${e} textarea`).val(SBF.restoreJson(s));break;case"select":$.find(`${e} select`).val(SBF.restoreJson(s));break;case"checkbox":$.find(`${e} input`).prop("checked","false"!=s&&s);break;case"radio":$.find(`${e} input[value="${SBF.restoreJson(s)}"]`).prop("checked",!0);break;case"upload-image":s&&$.find(e+" .image").attr("data-value",SBF.restoreJson(s)).css("background-image",`url("${SBF.restoreJson(s)}")`);break;case"multi-input":for(var n in s)this.set(n,s[n]);break;case"range":let i=SBF.restoreJson(s);$.find(e+" input").val(i),$.find(e+" .range-value").html(i);break;case"select-images":$.find(e+" .input > div").sbActive(!1),$.find(e+` .input > [data-value="${SBF.restoreJson(s)}"]`).sbActive(!0);break;case"repeater":let r=this.repeater("set",s,$.find(e+" .repeater-item:last-child"));r&&$.find(e+" .sb-repeater").html(r);break;case"double-select":for(var n in s)$.find(`${e} .input > [data-id="${n}"] select`).val(s[n]);break;case"timetable":for(var n in s){let i=$.find(`${e} [data-day="${n}"] > div > div`);for(var o=0;o<i.length;o++)t(i[o]).attr("data-value",s[n][o][0]).html(s[n][o][1])}break;case"color-palette":s&&$.find(e).attr("data-value",s)}},repeater:function(e,i,a){if(t(a).find(".sb-icon-close").remove(),a=t(a).html(),"set"==e){var s="";if(i.length>0)for(var n=0;n<i.length;n++){let e=t(t.parseHTML(`<div>${a}</div>`));for(var o in i[n])this.setInput(e.find(`[data-id="${o}"]`),i[n][o]);s+=`<div class="repeater-item">${e.html()}<i class="sb-icon-close"></i></div>`}return s}if("get"==e){let e=[],a=this;return t(i).each(function(){let i={},s=!0;t(this).find("[data-id]").each(function(){let e=a.getInput(this);s&&e&&"hidden"!=t(this).attr("type")&&"auto-id"!=t(this).attr("data-type")&&(s=!1),i[t(this).attr("data-id")]=e}),s||e.push(i)}),e}},repeaterAdd:function(e){let i=t(e).parent();(e=t(t.parseHTML(`<div>${i.find(".repeater-item:last-child").html()}</div>`))).find("[data-id]").each(function(){if(ht.resetInput(this),"auto-id"==t(this).data("type")){let e=1;i.find('[data-type="auto-id"]').each(function(){let i=parseInt(t(this).val());i>e&&(e=i)}),t(this).attr("value",e+1)}}),i.find(".sb-repeater").append(`<div class="repeater-item">${e.html()}</div>`)},repeaterDelete:function(e){let i=t(e).parent();i.parent().find(".repeater-item").length>1?i.remove():i.find("[data-id]").each((t,e)=>{this.resetInput(e)})},setInput:function(e,i){if(i=t.trim(i),(e=t(e)).is("select"))e.find(`option[value="${i}"]`).attr("selected","");else if(e.is(":checkbox")&&i&&"false"!=i)e.attr("checked","");else if(e.is("textarea"))e.html(i);else{let t=e.is("div");t||e.is("i")||e.is("li")?(e.attr("data-value",i),t&&e.hasClass("image")&&e.css("background-image",`url("${i}")`)):e.attr("value",i)}},getInput:function(e){if((e=t(e)).is(":checkbox"))return e.is(":checked");if(e.is("div")||e.is("i")||e.is("li")){let t=e.attr("data-value");return SBF.null(t)?"":t}return e.val()},resetInput:function(e){(e=t(e)).is("select")?e.val("").find("[selected]").removeAttr("selected"):e.is("checkbox")&&value?e.removeAttr("checked").prop("checked",!1):e.is("textarea")?e.html(""):e.removeAttr("value").removeAttr("style").removeAttr("data-value").val("")},getSettingObject:function(e){return t(e)[0].hasAttribute("data-setting")?t(e):t(e).closest("[data-setting]")},articles:{categories:[],articles:[],translations:{},get:function(t,e=!1,i=!0){SBF.ajax({function:"get-articles",categories:e,articles_language:"all",full:i},e=>{t(e)})},save:function(e=!1){this.updateActiveArticle(),F.find(".sb-new-category-cnt input").each((e,i)=>{let a=t.trim(t(i).val());a&&this.categories.push({id:SBF.random(),title:a}),t(i).parents().eq(1).remove()}),this.categories.length&&this.categories.sort(function(t,e){return t.title.localeCompare(e.title)}),SBF.ajax({function:"save-articles",articles:this.articles,translations:this.translations,categories:this.categories.length?this.categories:"delete_all"},t=>{F.find(".sb-menu-wide .sb-active").click(),F.find(`.sb-nav [data-id="${this.activeID()}"]`).click(),this.updateSelect(),e&&e(t)}),pt.is("dialogflow")&&SBF.ajax({function:"dialogflow-knowledge",articles:this.articles})},show:function(e=!1,i=!1,a=!1){let s=[-1,"","","",""];this.updateActiveArticle(),this.hide(!1);let n=a?a in this.translations?this.translations[a]:[]:this.articles;!1===e&&(e=this.activeID());for(o=0;o<n.length;o++)if(n[o].id==e){s=[e,n[o].title,n[o].content,n[o].link,SBF.null(n[o].categories)?[""]:n[o].categories,SBF.null(n[o].parent_category)?"":n[o].parent_category],i&&(t(i).siblings().sbActive(!1),t(i).sbActive(!0));break}I.val(""),L.val(s[5]);for(var o=0;o<s[4].length;o++)I.eq(o).val(s[4][o]);F.sbLanguageSwitcher(this.getTranslations(e),"articles",a),F.find(".sb-content").attr("data-id",s[0]),F.find(".sb-article-title input").val(s[1]),F.find(".sb-article-content textarea").val(s[2]),F.find(".sb-article-link input").val(s[3]),F.find("#sb-article-id").html(`ID <span>${s[0]}</span>`)},add:function(){let t=F.find(".sb-nav > ul"),e=SBF.random();this.updateActiveArticle(),this.articles.push({id:e,title:"",content:"",link:"",categories:[]}),this.hide(!1),t.find(".sb-active").sbActive(!1),t.find(".sb-no-results").remove(),t.append(`<li class="sb-active" data-id="${e}">${o("Article")} ${t.find("li").length+1}<i class="sb-icon-delete"></i></li>`),F.find("input, textarea, select").val(""),F.find(".sb-content").attr("data-id",e),F.sbLanguageSwitcher([],"articles")},addCategory:function(){F.find('[data-type="categories"] .sb-no-results').remove(),F.find(".sb-new-category-cnt").append('<div class="sb-input-setting sb-type-text"><div><input type="text"></div></div>')},delete:function(e,i=!1){let a=t(e).closest(".sb-nav").find(" > ul");this[i?"categories":"articles"].splice(t(e).parent().index(),1),this.hide(),a.find("li").length>1?t(e).parent().remove():a.html(`<li class="sb-no-results">${o("No results found.")}</li>`)},populate:function(t=!1,e=!1){if(!1===t&&(t=e?this.categories:this.articles),Array.isArray(t)){let a="";if(e?this.categories=t:this.articles=t,t.length)for(var i=0;i<t.length;i++)a+=`<li data-id="${t[i].id}">${e?"<span>"+t[i].id+"</span>":""}${t[i].title}<i class="sb-icon-delete${e?" sb-category":""}"></i></li>`;else a=`<li class="sb-no-results">${o("No results found.")}</li>`;F.find(".sb-add-category,.sb-new-category-cnt").sbActive(e),F.find(".sb-add-article").sbActive(!e),F.find(".sb-nav").attr("data-type",e?"categories":"articles"),F.find(".sb-nav > ul").html(a),this.hide()}else SBF.error(t,"SBSettings.articles.populate")},updateActiveArticle:function(){let e=this.activeID();if(-1!=e){let a=F.find(".sb-language-switcher [data-language].sb-active").attr("data-language"),s=a?a in this.translations?this.translations[a]:[]:this.articles,n=[];I.each(function(){t(this).val()&&n.push(t(this).val())});for(var i=0;i<s.length;i++)if(s[i].id==e){s[i]={id:e,title:F.find(".sb-article-title input").val(),content:F.find(".sb-article-content textarea").val(),link:F.find(".sb-article-link input").val(),categories:n,parent_category:L.val()},SBF.null(s[i].title)&&this.delete(F.find(`.sb-nav [data-id="${e}"] i`));break}}},updateSelect:function(){let e=[],i=L.val(),a='<option value=""></option>';I.each(function(){e.push(t(this).val())});for(s=0;s<this.categories.length;s++)a+=`<option value="${this.categories[s].id}">${this.categories[s].title}</option>`;I.html(a),L.html(a),L.val(i);for(var s=0;s<e.length;s++)I.eq(s).val(e[s])},addTranslation:function(t=!1,e){if(!1===t&&(t=this.activeID()),this.getTranslations(t).includes(t))return console.warn("Article translation already in array.");e in this.translations||(this.translations[e]=[]),this.translations[e].push({id:t,title:"",content:"",link:"",categories:[]})},getTranslations:function(t=!1){let e=[];!1===t&&(t=this.activeID());for(var i in this.translations){let s=this.translations[i];for(var a=0;a<s.length;a++)if(s[a].id==t){e.push(i);break}}return e},deleteTranslation:function(t=!1,e){if(!1===t&&(t=this.activeID()),e in this.translations){let a=this.translations[e];for(var i=0;i<a.length;i++)if(a[i].id==t)return this.translations[e].splice(i,1),!0}return!1},activeID:function(){return F.find(".sb-content").attr("data-id")},hide:function(t=!0){F.find(".sb-content").setClass("sb-hide",t)}},automations:{items:{messages:[],emails:[],sms:[],popups:[],design:[]},translations:{},conditions:{datetime:["Date time",["Is between","Is exactly"],"dd/mm/yyy hh:mm - dd/mm/yyy hh:mm"],repeat:["Repeat",["Every day","Every week","Every month","Every year"]],browsing_time:["Browsing time",[],"seconds"],scroll_position:["Scroll position",[],"px"],include_urls:["Include URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],exclude_urls:["Exclude URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],referring:["Referring URLs",["Contains","Does not contain","Is exactly","Is not"],"URLs parts separated by commas"],user_type:["User type",["Is visitor","Is lead","Is user","Is not visitor","Is not lead","Is not user"]],returning_visitor:["Returning visitor",["First time visitor","Returning visitor"]],countries:["Countries",[],"Country codes separated by commas"],languages:["Languages",[],"Language codes separated by commas"],cities:["Cities",[],"Cities separated by commas"],custom_variable:["Custom variable",[],"variable=value"]},get:function(t){SBF.ajax({function:"automations-get"},e=>{this.items=e[0],this.translations=Array.isArray(e[1])&&!e[1].length?{}:e[1],t(e)})},save:function(t=!1){this.updateActiveItem(),SBF.ajax({function:"automations-save",automations:this.items,translations:this.translations},e=>{t&&t(e)})},show:function(t=!1,e=!1){this.updateActiveItem();let i=e?e in this.translations?this.translations[e]:[]:this.items,a=E.find(" > .sb-tab > .sb-content");!1===t&&(t=this.activeID()),this.hide(!1);for(var s in i)for(var n=0;n<i[s].length;n++){let o=i[s][n],r=o.conditions;if(o.id==t){R.html("");for(var s in o){let t=a.find(`[data-id="${s}"]`);t.hasClass("image")?(t.css("background-image",`url(${o[s]})`).attr("data-value",o[s]),""==o[s]&&t.removeAttr("data-value")):"checkbox"==t.attr("type")?t.prop("checked",o[s]):t.val(o[s])}if(r)for(var s in r){this.addCondition();let t=R.find(" > div:last-child");t.find("select").val(r[s][0]),this.updateCondition(t.find("select")),t.find(" > div").eq(1).find("select,input").val(r[s][1]),r[s].length>2&&t.find(" > div").eq(2).find("input").val(r[s][2])}return R.parent().setClass("sb-hide",e),a.sbLanguageSwitcher(this.getTranslations(t),"automations",e),!0}}return!1},add:function(){let t=SBF.random(),e=`${o("Item")} ${M.find("li:not(.sb-no-results)").length+1}`;this.updateActiveItem(),this.items[this.activeType()].push(this.itemArray(this.activeType(),t,e)),this.hide(!1),M.find(".sb-active").sbActive(!1),M.find(".sb-no-results").remove(),M.append(`<li class="sb-active" data-id="${t}">${e}<i class="sb-icon-delete"></i></li>`),E.find(".sb-automation-values").find("input, textarea").val(""),E.sbLanguageSwitcher([],"automations"),R.html("")},delete:function(e){this.items[this.activeType()].splice(t(e).parent().index(),1),t(e).parent().remove(),this.hide(),0==this.items[this.activeType()].length&&M.html(`<li class="sb-no-results">${o("No results found.")}</li>`)},populate:function(t=!1){!1===t&&(t=this.activeType());let e="",i=this.items[t];if(this.updateActiveItem(),i.length)for(a=0;a<i.length;a++)e+=`<li data-id="${i[a].id}">${i[a].name}<i class="sb-icon-delete"></i></li>`;else e=`<li class="sb-no-results">${o("No results found.")}</li>`;switch(M.html(e),e="",t){case"emails":e=`<h2>${o("Subject")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="subject" type="text"></div></div>`;break;case"popups":e=`<h2>${o("Title")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="title" type="text"></div></div><h2>${o("Profile image")}</h2><div data-type="upload-image" class="sb-input-setting sb-type-upload-image"><div class="input"><div data-id="profile_image" class="image"><i class="sb-icon-close"></i></div></div></div><h2>${o("Message fallback")}</h2><div class="sb-input-setting sb-type-checkbox"><div><input data-id="fallback" type="checkbox"></div></div>`;break;case"design":e=`<h2>${o("Header title")}</h2><div class="sb-input-setting sb-type-text"><div><input data-id="title" type="text"></div></div>`;for(a=1;a<4;a++)e+=`<h2>${o((1==a?"Primary":2==a?"Secondary":"Tertiary")+" color")}</h2><div data-type="color" class="sb-input-setting sb-type-color"><div class="input"><input data-id="color_${a}" type="text"><i class="sb-close sb-icon-close"></i></div></div>`;for(var a=1;a<4;a++)e+=`<h2>${o(1==a?"Header background image":2==a?"Header brand image":"Chat button icon")}</h2><div data-type="upload-image" class="sb-input-setting sb-type-upload-image"><div class="input"><div data-id="${1==a?"background":2==a?"brand":"icon"}" class="image"><i class="sb-icon-close"></i></div></div></div>`}E.find(".sb-automation-extra").html(e),ht.initColorPicker(E),this.hide()},updateActiveItem:function(){let e=this.activeID();if(e){let a=E.find(".sb-language-switcher [data-language].sb-active").attr("data-language"),s=this.activeType(),n=a?a in this.translations?this.translations[a][s]:[]:this.items[s],o=R.find(" > div");for(var i=0;i<n.length;i++)if(n[i].id==e){n[i]={id:e,conditions:[]},E.find(".sb-automation-values").find('input,textarea,[data-type="upload-image"] .image').each(function(){n[i][t(this).attr("data-id")]=t(this).hasClass("image")&&t(this)[0].hasAttribute("data-value")?t(this).attr("data-value"):"checkbox"==t(this).attr("type")?t(this).is(":checked"):t(this).val()}),o.each(function(){let e=[];t(this).find("input,select").each(function(){e.push(t(this).val())}),e[0]&&e[1]&&(2==e.length||e[2])&&n[i].conditions.push(e)}),SBF.null(n[i].name)&&this.delete(M.find(`[data-id="${e}"] i`));break}}},addCondition:function(){R.append(`<div><div class="sb-input-setting sb-type-select sb-condition-1"><select>${this.getAvailableConditions()}</select></div></div>`)},updateCondition:function(e){t(e).parent().siblings().remove();let i=t(e).parents().eq(1);if(t(e).val()){let s=this.conditions[t(e).val()],n="";if(s[1].length){n='<div class="sb-input-setting sb-type-select sb-condition-2"><select>';for(var a=0;a<s[1].length;a++)n+=`<option value="${SBF.stringToSlug(s[1][a])}">${o(s[1][a])}</option>`;n+="</select></div>"}i.append(n+(s.length>2?`<div class="sb-input-setting sb-type-text"><input placeholder="${o(s[2])}" type="text"></div>`:"")),i.siblings().find(".sb-condition-1 select").each(function(){let e=t(this).val();t(this).html(ht.automations.getAvailableConditions(e)),t(this).val(e)})}else i.remove()},getAvailableConditions:function(e=""){let i='<option value=""></option>',a=[];R.find(".sb-condition-1 select").each(function(){a.push(t(this).val())});for(var s in this.conditions)a.includes(s)&&s!=e||(i+=`<option value="${s}">${o(this.conditions[s][0])}</option>`);return i},addTranslation:function(t=!1,e=!1,i){if(!1===t&&(t=this.activeID()),!1===e&&(e=this.activeType()),this.getTranslations(t).includes(t))return console.warn("Automation translation already in array.");i in this.translations||(this.translations[i]={messages:[],emails:[],sms:[],popups:[],design:[]}),e in this.translations[i]||(this.translations[i][e]=[]),this.translations[i][e].push(this.itemArray(e,t))},getTranslations:function(t=!1){let e=[];!1===t&&(t=this.activeID());for(var i in this.translations){let n=this.translations[i];for(var a in n){let o=n[a];for(var s=0;s<o.length;s++)if(o[s].id==t){e.push(i);break}}}return e},deleteTranslation:function(t=!1,e){if(!1===t&&(t=this.activeID()),e in this.translations){let s=this.translations[e];for(var i in s){let n=s[i];for(var a=0;a<n.length;a++)if(n[a].id==t)return this.translations[e][i].splice(a,1),!0}}return!1},activeID:function(){let t=M.find(".sb-active");return!!t.length&&t.attr("data-id")},activeType:function(){return N.find("li.sb-active").data("value")},itemArray:function(e,i,a="",s=""){return t.extend({id:i,name:a,message:s},"emails"==e?{subject:""}:"popups"==e?{title:"",profile_image:""}:"design"==e?{title:"",color_1:"",color_2:"",color_3:"",background:"",brand:"",icon:""}:{})},hide:function(t=!0){E.find(" > .sb-tab > .sb-content").setClass("sb-hide",t)}},translations:{translations:{},originals:{},to_update:{},add:function(t){let e=ht.getSettingObject(j),i=e.attr("id"),a=j.find("[data-language].sb-active");this.save(e,!!a.length&&a.attr("data-language")),e.find('textarea,input[type="text"]').val(""),this.save(e,t),j.remove(),e.sbLanguageSwitcher(this.getLanguageCodes(i),"settings",t)},delete:function(t,e){let i=(t=ht.getSettingObject(t)).attr("id");delete this.translations[e][i],t.find(`.sb-language-switcher [data-language="${e}"]`).remove(),this.activate(t)},activate:function(t,e=!1){let i=(t=ht.getSettingObject(t)).attr("id"),a=e?this.translations[e][i]:this.originals[i];if("string"==typeof a)t.find("input, textarea").val(a);else for(var s in a)t.find("#"+s).find("input, textarea").val("string"==typeof a[s]?a[s]:a[s][0])},updateActive:function(){let e=$.find(".sb-translations-list"),i={front:{},admin:{},"admin/js":{},"admin/settings":{}},a=e.attr("data-value");if(!SBF.null(a)){for(var s in i)e.find(' > [data-area="'+s+'"] .sb-input-setting:not(.sb-new-translation)').each(function(){i[s][t(this).find("label").html()]=t(this).find("input").val()}),e.find('> [data-area="'+s+'"] .sb-new-translation').each(function(){let e=t(this).find("input:first-child").val(),a=t(this).find("input:last-child").val();e&&a&&(i[s][e]=a)});this.to_update[a]=i}},save:function(e,i=!1){e=ht.getSettingObject(e);let a={},s=t(e).attr("id");"multi-input"==e.data("type")?e.find(".multi-input-textarea,.multi-input-text").each(function(){a[t(this).attr("id")]=t(this).find("input, textarea").val()}):a=e.find("input, textarea").val(),i?(i in this.translations||(this.translations[i]={}),this.translations[i][s]=a):this.originals[s]=a},load:function(t){let e=$.find(".sb-translations > .sb-content");e.find(" > .sb-hide").removeClass("sb-hide"),this.updateActive(),SBF.ajax({function:"get-translation",language_code:t},i=>{t in this.to_update&&(i=this.to_update[t]);let a="",s=["front","admin","admin/js","admin/settings"];for(var n=0;n<s.length;n++){let t=i[s[n]];a+=`<div${n?"":' class="sb-active"'} data-area="${s[n]}">`;for(var o in t)a+=`<div class="sb-input-setting sb-type-text"><label>${o}</label><div><input type="text" value="${t[o]}"></div></div>`;a+="</div>"}e.find(".sb-translations-list").attr("data-value",t).html(a),e.find(".sb-menu-wide li").sbActive(!1).eq(0).sbActive(!0),e.sbLoading(!1)}),e.sbLoading(!0)},getLanguageCodes:function(t){let e=[];for(var i in this.translations)t in this.translations[i]&&e.push(i);return e}}},ft={chart:!1,active_report:!1,initChart:function(t,e="line",i=1){let a=[],s=[],n=["#049CFF","#74C4F7","#B9E5FF","#0562A0","#003B62","#1F74C4","#436786"];for(var o in t)a.push(t[o][0]),s.push(o);if("line"!=e&&a.length>6)for(var r=0;r<a.length;r++)n.push("hsl(210, "+Math.floor(100*Math.random())+"%, "+Math.floor(100*Math.random())+"%)");this.chart&&this.chart.destroy(),this.chart=new Chart(D.find("canvas"),{type:e,data:{labels:s,datasets:[{data:a,backgroundColor:"line"==e?"#028be530":n,borderColor:"line"==e?"#049CFF":"#FFFFFF",borderWidth:0}]},options:{legend:{display:!1},scales:{yAxes:[{ticks:{callback:function(t,e,a){return 1==i?t:2==i?new Date(1e3*t).toISOString().substr(11,8):t},beginAtZero:!0}}],xAxes:[{ticks:{beginAtZero:!0}}]},tooltips:{callbacks:{label:function(t,e){let s=t.index,n=e.datasets[0].data[s];switch(i){case 1:return n;case 2:return new Date(1e3*a[s]).toISOString().substr(11,8);case 3:return n+"%";case 4:let t=D.find(".sb-table tbody tr").eq(s).find("td");return t.eq(0).text()+" "+t.eq(1).text()}}},displayColors:!1}}})},initTable:function(t,e,i=!1){let a="<thead><tr>",s=e[Object.keys(e)[0]].length-1,n=[];for(r=0;r<t.length;r++)a+=`<th>${t[r]}</th>`;a+="</tr></thead><tbody>";for(var o in e)0!=e[o][s]&&n.push([o,e[o][s]]);i&&n.reverse();for(var r=0;r<n.length;r++)a+=`<tr><td><div>${n[r][0]}</div></td><td>${n[r][1]}</td></tr>`;a+="</tbody>",D.find("table").html(a)},initReport:function(t=!1,e=!1){let i=D.find(".sb-tab > .sb-content");e=SBF.null(e)?[!1,!1]:e.split(" - "),i.sbLoading(!0),t&&(this.active_report=t),this.active_report&&this.getData(this.active_report,e[0],e[1],t=>{0==t?i.addClass("sb-no-results-active"):(i.removeClass("sb-no-results-active"),this.initChart(t.data,t.chart_type,t.label_type),this.initTable(t.table,t.data,t["table-inverse"]),D.find(".sb-reports-title").html(t.title),D.find(".sb-reports-text").html(t.description),D.find(".sb-collapse-btn").remove(),at||l(D.find(".sb-collapse"),D.find("canvas").outerHeight()-135)),i.sbLoading(!1)})},getData:function(t,e=!1,i=!1,a){SBF.ajax({function:"reports",name:t,date_start:e,date_end:i},t=>{a(t)})},initDatePicker:function(){let t={ranges:{},locale:{format:"DD/MM/YYYY",separator:" - ",applyLabel:o("Apply"),cancelLabel:o("Cancel"),fromLabel:o("From"),toLabel:o("To"),customRangeLabel:o("Custom"),weekLabel:o("W"),daysOfWeek:[o("Su"),o("Mo"),o("Tu"),o("We"),o("Th"),o("Fr"),o("Sa")],monthNames:[o("January"),o("February"),o("March"),o("April"),o("May"),o("June"),o("July"),o("August"),o("September"),o("October"),o("November"),o("December")],firstDay:1},showCustomRangeLabel:!0,alwaysShowCalendars:!0,autoApply:!0};t.ranges[o("Today")]=[moment(),moment()],t.ranges[o("Yesterday")]=[moment().subtract(1,"days"),moment().subtract(1,"days")],t.ranges[o("Last 7 Days")]=[moment().subtract(6,"days"),moment()],t.ranges[o("Last 30 Days")]=[moment().subtract(29,"days"),moment()],t.ranges[o("This Month")]=[moment().startOf("month"),moment().endOf("month")],t.ranges[o("Last Month")]=[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],D.find("#sb-date-picker").daterangepicker(t).val("")}},gt={real_time:null,datetime_last_user:"2000-01-01 00:00:00",sorting:["creation_time","DESC"],user_types:["visitor","lead","user"],user_main_fields:["id","first_name","last_name","email","password","profile_image","user_type","creation_time","token","last_activity","department"],search_query:"",init:!1,busy:!1,table_extra:!1,history:[],filter:function(t){t="all"==t?["visitor","lead","user"]:"agent"==t?["agent","admin"]:[t],this.user_types=t,this.loading(),et=1,it=1;let e="online"==t[0]?["get-online-users",SB_ACTIVE_AGENT.id,this.sorting[0]]:["get-users",-1,this.sorting];SBF.ajax({function:e[0],sorting:e[2],user_types:t,search:this.search_query,extra:this.table_extra},t=>{this.populate(t),this.loading(!1)})},sort:function(t,e="DESC"){this.sorting=[t,e],this.loading(),et=1,it=1,SBF.ajax({function:"get-users",sorting:this.sorting,user_types:this.user_types,search:this.search_query,extra:this.table_extra},t=>{this.populate(t),this.loading(!1)})},search:function(e){c(e,(e,i)=>{et=1,it=1,SBF.ajax({function:e.length>1?"search-users":"get-users",search:e,user_types:this.user_types,sorting:this.sorting,extra:this.table_extra},a=>{this.user_types=["visitor","lead","user"],this.populate(a),this.search_query=e,t(i).sbLoading(!1),A.find("li").sbActive(!1).eq(0).sbActive(!0)})})},populate:function(e){let i="",a=e.length;if(a)for(var s=0;s<a;s++)i+=this.getRow(new SBUser(e[s],e[s].extra));else i=`<p class="sb-no-results">${o("No users found.")}</p>`;k.parent().scrollTop(0),k.find("tbody").html(i),this.user_types.includes("agent")&&SBF.ajax({function:"get-online-users",agents:!0},e=>{let i=[];for(var a=0;a<e.length;a++)i.push(e[a].id);k.find("[data-user-id]").each(function(){t(this).find(".sb-td-profile").addClass("sb-"+(i.includes(t(this).attr("data-user-id"))?"online":"offline"))})})},update:function(){if(!this.busy){let t=["user","visitor","lead","agent"],e=t.includes(this.user_types[0])&&""==this.search_query,i=A.find(".sb-active").data("type");"online"==i?this.filter(i):(this.busy=!0,SBF.ajax({function:"get-new-users",datetime:this.datetime_last_user},a=>{let s=a.length;if(this.busy=!1,s>0){let o="";for(n=0;n<s;n++){let t=new SBUser(a[n]);tt[t.id]=t,this.updateMenu("add",t.type),e&&(o+=this.getRow(t))}if(e&&(k.find("tbody").prepend(o),t.includes(i))){let e="";for(var n=0;n<t.length;n++)e+=t[n]==i?"":`[data-user-type="${t[n]}"],`;k.find(e.slice(0,-1)).remove()}this.datetime_last_user=a[0].creation_time}}))}},getRow:function(t){if(t instanceof SBUser){let i="";for(var e=0;e<this.table_extra.length;e++){let a=this.table_extra[e];i+=`<td class="sb-td-${a}">${this.user_main_fields.includes(a)?t.get(a):t.getExtra(a)}</td>`}return`<tr data-user-id="${t.id}" data-user-type="${t.type}"><td><input type="checkbox" /></td><td class="sb-td-profile"><a class="sb-profile"><img src="${t.image}" /><span>${t.name}</span></a></td>${i}<td class="sb-td-email">${t.get("email")}</td><td class="sb-td-ut">${o(t.type)}</td><td>${SBF.beautifyTime(t.get("last_activity"),!0)}</td><td>${t.get("creation_time")}</td></tr>`}return SBF.error("User not of type SBUser","SBUsers.getRow"),!1},updateRow:function(t){let e=k.find(`[data-user-id="${t.id}"]`);if(e.length){let i=A.find(".sb-active").data("type");if(t.type==i||"admin"==t.type&&"agent"==i||"all"==i)e.replaceWith(this.getRow(t));else{let i=f.find(`[data-type="${"admin"==t.type?"agent":t.type}"] span`),a=parseInt(i.attr("data-count"));i.html(a+1).attr("data-count",a+1),e.remove()}}else k.find("tbody").append(this.getRow(t))},updateMenu:function(t="all",e=!1){let i=["all","user","lead","visitor"];"all"==t?SBF.ajax({function:"count-users"},t=>{for(var e=0;e<i.length;e++)this.updateMenuItem("set",i[e],t[i[e]])}):this.updateMenuItem(t,e)},updateMenuItem:function(t="set",e=!1,i=1){let a=A.find(`[data-type="${e}"] span`),s=["user","lead","visitor"];"set"!=t&&(i=parseInt(a.attr("data-count"))+1*("add"==t?1:-1)),a.html(`(${i})`).attr("data-count",i),i=0;for(var n=0;n<s.length;n++)i+=parseInt(A.find(`[data-type="${s[n]}"] span`).attr("data-count"));A.find('[data-type="all"] span').html(`(${i})`).attr("data-count",i)},delete:function(t){if(this.loading(),Array.isArray(t)){if(SB_ADMIN_SETTINGS.cloud&&!(t=SBCloud.removeAdminID(t)).length)return;SBF.ajax({function:"delete-users",user_ids:t},()=>{for(var i=0;i<t.length;i++)delete tt[t[i]],k.find(`[data-user-id="${t[i]}"]`).remove(),m.find(`[data-user-id="${t[i]}"]`).remove();0==k.find("[data-user-id]").length&&this.filter(A.find(".sb-active").data("type")),e("Users deleted"),this.updateMenu(),this.loading(!1)})}else tt[t].delete(()=>{let a=m.find(`[data-user-id="${t}"]`);i().id==t&&i(!1),a.sbActive()&&(SBChat.conversation=!1,setTimeout(()=>{bt.clickFirst()},300)),delete tt[t],k.find(`[data-user-id="${t}"]`).remove(),a.remove(),f.sbHideLightbox(),e("User deleted"),this.updateMenu(),this.loading(!1)})},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update()},1e3))},stopRealTime:function(){clearInterval(this.real_time)},loading:function(t=!0){let e=x.find(".sb-loading-table");t?e.sbActive(!0):e.sbActive(!1)},csv:function(){SBF.ajax({function:"csv-users"},t=>window.open(t))},updateUsersActivity:function(){SBF.updateUsersActivity(lt?SB_ACTIVE_AGENT.id:-1,i()?i().id:-1,function(t){gt.setActiveUserStatus("online"==t)})},setActiveAgentStatus:function(t=!0){lt=t,g.find('[data-value="status"]').html(o(t?"Online":"Offline")).attr("class",t?"sb-online":"sb-offline"),SBPusher.active&&(t?SBPusher.presence():SBPusher.presenceUnsubscribe())},setActiveUserStatus:function(t=!0){let e=b.find(".sb-conversation .sb-top > .sb-labels");e.find(".sb-status-online").remove(),t&&e.prepend(`<span class="sb-status-online">${o("Online")}</span>`),SBChat.user_online=t},onlineUserNotification:function(t){let e=SB_ADMIN_SETTINGS["online-users-notification"];if(e){let i=t.info.first_name+" "+t.info.last_name,a=this.userProfileImage(t.info.profile_image);SB_ADMIN_SETTINGS["push-notifications"]&&"id"in t.info&&!this.history.includes(t.info.id)?SBF.ajax({function:"push-notification",title:e,message:i,icon:a,interests:SB_ACTIVE_AGENT.id,user_id:t.info.id}):bt.desktop_notifications&&SBChat.desktopNotification(e,i,a,!1,t.info.id),this.history.push(t.info.id)}},userProfileImage:function(t){return!t||t.indexOf("user.svg")?SB_ADMIN_SETTINGS["notifications-icon"]:t}},bt={real_time:null,datetime_last_conversation:"2000-01-01 00:00:00",user_typing:!1,desktop_notifications:!1,flash_notifications:!1,busy:!1,is_search:!1,menu_count_ajax:!1,open:function(t=-1,e){-1!=t&&this.openConversation(t,e),f.sbHideLightbox(),g.find(".sb-admin-nav a").sbActive(!1).parent().find("#sb-conversations").sbActive(!0),f.find(" > main > div").sbActive(!1),b.sbActive(!0).find(".sb-board").removeClass("sb-no-conversation"),this.startRealTime()},openConversation:function(e,a=!1,s=!0){if(!1===a&&e)SBF.ajax({function:"get-user-from-conversation",conversation_id:e},t=>{SBF.null(t.id)?SBF.error("Conversation not found","SBAdmin.openConversation"):this.openConversation(e,t.id,s)});else{let n=b.find(".sb-conversation .sb-list"),r=SBF.null(tt[a])||!("email"in tt[a].details),l=b.find(`[data-conversation-id="${e}"]`);n.html(""),n.sbLoading(!0),r?(i(new SBUser({id:a})),i().update(()=>{tt[a]=i(),this.updateUserDetails()})):i(tt[a]),SBPusher.active&&(SBPusher.event("client-typing",t=>{t.user_id==i().id&&(bt.typing(!0),clearTimeout(V),V=setTimeout(()=>{bt.typing(!1)},1e3))}),SBPusher.event("new-message",()=>{SBChat.update()}),SBPusher.event("agent-active-conversation-changed",t=>{t.previous_conversation_id==e&&b.find(".sb-conversation-busy").remove()},"agents"),SBPusher.event("init",()=>{bt.updateCurrentURL()})),SB_ADMIN_SETTINGS["smart-reply"]&&w.html(""),m.find("li").sbActive(!1),l.sbActive(!0),-1!=e?i().getFullConversation(e,e=>{let a=e.get("conversation_status_code"),r=v.find(".sb-select"),c=r.find(".sb-active").attr("data-value");if(SBChat.setConversation(e),SBChat.populate(),b.find(".sb-top > a").html(e.get("title")),b.find('.sb-top [data-value="read"]').sbActive(2==a),b.find(".sb-conversation-busy").remove(),this.updateUserDetails(),mt.must_translate=SB_ADMIN_SETTINGS.translation&&i().language&&SB_ADMIN_SETTINGS["active-agent-language"]!=i().language,mt.must_translate){let t=[],i=[],a=[];for(p=0;p<e.messages.length;p++){let s=e.messages[p];"bot"!=s.get("user_type")&&(t.push(s.message),i.push(s.id),a.push(s.get("user_type")))}pt.dialogflow.translate(t,SB_ADMIN_SETTINGS["active-agent-language"],t=>{if(t)for(var e=0;e<t.length;e++){let s=SBChat.conversation.getMessage(i[e]);n.find(`[data-id="${i[e]}"] .sb-message`).html(t[e].translatedText),n.find(`[data-id="${i[e]}"] .sb-menu`).prepend(`<li data-value="original">${o(SBF.isAgent(a[e])?"View translation":"View original message")}</li>`),s&&s.set("translation",t[e].translatedText)}})}let d=b.find("#conversation-department");if(d.length){let t=d.find(`[data-id="${e.get("department")}"]`);d.find(" > p").attr("data-value",t.data("value")).html(t.html())}let u=b.find("#conversation-agent");if(u.length){let t=u.find(`[data-id="${e.get("agent_id")}"]`);u.find(" > p").attr("data-value",t.data("id")).html(t.html())}if([1,2].includes(a)&&(a=0),c==a||t(v).find(".sb-search-btn").sbActive()||(r.find(`[data-value="${a}"]`).click(),r.find("ul").sbActive(!1)),at&&this.mobileOpenConversation(),l.length||c!=a&&(0!=c||1!=a)||m.prepend(bt.getListCode(e).replace("<li",'<li class="sb-active"')),l.sbActive(!0),s&&this.scrollTo(),e.get("busy")&&b.find(".sb-editor > .sb-labels").prepend(`<span data-agent="${e.get("busy")}" class="sb-status-warning sb-conversation-busy">${o("Another agent is replying to this conversation")}</span>`),pt.is("woocommerce")&&pt.woocommerce.conversationPanel(),pt.is("ump")&&pt.ump.conversationPanel(),pt.is("perfex")&&pt.perfex.conversationPanel(),pt.is("whmcs")&&pt.whmcs.conversationPanel(),pt.is("aecommerce")&&pt.aecommerce.conversationPanel(),pt.is("armember")&&pt.armember.conversationPanel(),this.notes.update(e.details.notes),this.attachments(),SB_ADMIN_SETTINGS["smart-reply"]){let t=e.getLastUserMessage();w.html(""),t&&t.payload("sb-human-takeover")&&(t=e.getLastUserMessage(t.get("index"))),t&&(pt.dialogflow.smart_reply_data=!1,pt.dialogflow.smartReply(t.message))}for(var p=e.messages.length-1;p>0;p--){let t=e.messages[p].get("payload"),i=!1;if(t&&"rich-messages"in t)for(var h in t["rich-messages"]){let e=t["rich-messages"][h];if("rating"==e.type){b.find(".sb-profile-list > ul").append(`<li data-id="rating"><i class="sb-icon sb-icon-${1==e.result.rating?"like":"dislike"}"></i><span>${o("User rating")}</span><label>${o(1==e.result.rating?"Helpful":"Not helpful")}</label></li>`),i=!0;break}}if(i)break}i().getConversations(function(t){b.find(".sb-user-conversations").html(i().getConversationsCode(t))}),n.sbLoading(!1)}):(SBChat.clear(),m.find("li").sbActive(!1),n.sbLoading(!1)),r||this.updateUserDetails(),b.find(".sb-board").removeClass("sb-no-conversation"),gt.updateUsersActivity(),this.startRealTime(),SBF.getURL("conversation")!=e&&u("?conversation="+e)}},populate:function(t,e,i){this.openConversation(t,e,i)},populateList:function(t){let e="";J=[];for(var i=0;i<t.length;i++)e+=this.getListCode(t[i]),J.push(t[i]);""==e&&(e=`<p class="sb-no-results">${o("No conversations found.")}</p>`),m.html(e),this.updateMenu(),SBF.event("SBAdminConversationsLoaded",{conversations:t})},update:function(){if(!this.busy&&(this.busy=!0,SBF.ajax({function:"get-new-conversations",datetime:this.datetime_last_conversation,routing:SB_ADMIN_SETTINGS.routing,routing_unassigned:SB_ADMIN_SETTINGS["assign-conversation-to-agent"]},e=>{if(this.busy=!1,e.length){let s,n="",o="",r=SBChat.conversation?SBChat.conversation.id:-1,l=!1,c=[];this.datetime_last_conversation=e[0].creation_time;for(var a=0;a<e.length;a++)if(!c.includes(e[a].conversation_id)){let t=e[a],d=t.conversation_status_code,u=t.user_id,p=t.conversation_id,h=r==p,f=this.getListCode(t,null),g=m.find(`[data-conversation-id="${p}"]`),v=g.index(),S=g.length,_=SBF.null(e[a].payload)?{}:JSON.parse(e[a].payload);if(h?(f=f.replace("<li",'<li class="sb-active"'),S?(t.message&&g.replaceWith(f),J[v].conversation_status_code=d,b.find('.sb-top [data-value="read"]').sbActive(2==d)):l=!0):S&&(J[v]=t,m.find(`[data-conversation-id="${p}"]`).remove()),u in tt||(tt[u]=new SBUser({id:u,first_name:t.first_name,last_name:t.last_name,profile_image:t.profile_image,user_type:t.user_type})),h&&S||(2==d?(n+=f,J.unshift(t)):0!=d&&1!=d||(0==(s=m.find('[data-conversation-status="2"]').last()).length?n+=f:(J.splice(s.index()+1,0,t),o+=f)),u==i().id&&i().getConversations(function(t){b.find(".sb-user-conversations").html(i().getConversationsCode(t))}),SBF.event("SBAdminNewConversation",{conversation:t})),i()&&("event"in _&&"update-user"==_.event||tt[u].type!=t.user_type)&&i().update(()=>{this.updateUserDetails(),tt[i().id]=i()}),!SBChat.tab_active&&2==t.conversation_status_code&&(!SBF.isAgent(t.message_user_type)||"preview"in _)&&(!SBF.null(t.message)||!SBF.null(t.attachments)||"preview"in _)){if(this.desktop_notifications){let e=[t.first_name+" "+t.last_name,gt.userProfileImage(t.profile_image)];SBChat.desktopNotification(e[0],"preview"in _?_.preview:t.message,e[1],p,u)}this.flash_notifications&&SBChat.flashNotification(),SBChat.audio&&["a","c","ic"].includes(SB_ADMIN_SETTINGS.sounds)&&SBChat.audio.play()}c.push(p)}n&&m.prepend(n),o&&t(o).insertAfter(s),l&&this.scrollTo(),this.updateMenu()}}),SB_ADMIN_SETTINGS["assign-conversation-to-agent"]||SB_ACTIVE_AGENT.department)){let e=m.find(" > li").map(function(){return t(this).attr("data-conversation-id")}).get();e.length&&SBF.ajax({function:"check-conversations-assignment",conversations_ids:e,agent_id:!!SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&SB_ACTIVE_AGENT.id,department:SB_ACTIVE_AGENT.department},t=>{if(t)for(var e=0;e<t.length;e++)m.find(`[data-conversation-id="${t[e]}"]`).remove()})}},updateMenu:function(){let t=m.find('[data-conversation-status="2"]').length,e=v.find(".sb-select"),i=e.find(" > p span");if(100==t||this.menu_count_ajax){let t=e.find("li.sb-active").data("value");this.menu_count_ajax=!0,SBF.ajax({function:"count-conversations",status_code:0==t?2:t},t=>{i.html(`(${t})`)})}else i.html(`(${t})`)},messageMenu:function(t){return`<i class="sb-menu-btn sb-icon-menu"></i><ul class="sb-menu">${pt.is("dialogflow")?`<li data-value="bot">${o("Send to Dialogflow")}</li>`:""}${t?`<li data-value="delete">${o("Delete")}</li>`:""}</ul>`},updateUserDetails(){i()&&(b.find(`[data-user-id="${i().id}"] .sb-name,.sb-top > a`).html(i().name),b.find(".sb-user-details .sb-profile").setProfile(),vt.populate(i(),b.find(".sb-profile-list")))},getListCode:function(t,e){t instanceof SBConversation&&(t={message:t.getLastMessage().message,attachments:t.getLastMessage().attachments,user_id:t.get("user_id"),conversation_id:t.id,conversation_status_code:t.get("conversation_status_code"),conversation_source:t.get("source"),profile_image:t.get("profile_image"),first_name:t.get("first_name"),last_name:t.get("last_name"),creation_time:t.get("creation_time"),payload:t.get("payload")});let i=t.message;if(t.payload.includes("preview")){let e=JSON.parse(t.payload.replace("\\'","'"));e&&"preview"in e&&(i=e.preview)}if(SBF.null(e)&&(e=t.conversation_status_code),""==i&&!SBF.null(t.attachments)){let e=JSON.parse(t.attachments);if(Array.isArray(e)){for(var a=0;a<e.length;a++)i+=e[a][0]+" ";i.length>114&&(i=i.substr(0,114)+" ...")}}return i.length>110&&(i=i.substr(0,110)+" ..."),`<li data-user-id="${t.user_id}" data-conversation-id="${t.conversation_id}" data-conversation-status="${e}"${SBF.null(t.conversation_source)?"":` data-conversation-source="${t.conversation_source}"`}><div class="sb-profile"><img src="${t.profile_image}"><span class="sb-name">${t.first_name} ${t.last_name}</span><span class="sb-time">${SBF.beautifyTime(t.creation_time)}</span></div><p>${i}</p></li>`},startRealTime:function(){SBPusher.active||(this.stopRealTime(),this.real_time=setInterval(()=>{this.update(),this.updateCurrentURL()},1e4),SBChat.startRealTime())},stopRealTime:function(){clearInterval(this.real_time),SBChat.stopRealTime()},transcript:function(t,e=!1){if(!("email"!=e||i()&&i().get("email")))return!1;SBF.ajax({function:"transcript",conversation_id:t},t=>{"email"==e?SBChat.sendEmail(SB_ADMIN_SETTINGS["transcript-message"],[[t,t]],!0):window.open(t)})},typing:function(t){t?SBChat.user_online&&!this.user_typing&&(b.find(".sb-conversation .sb-top > .sb-labels").append('<span class="sb-status-typing">'+o("Typing")+"</span>"),this.user_typing=!0):this.user_typing&&(b.find(".sb-conversation .sb-top .sb-status-typing").remove(),this.user_typing=!1)},scrollTo:function(){let t=m.find(".sb-active"),e=t.length?t[0].offsetTop:0;m.parent().scrollTop(e-(at?120:70))},search:function(e){c(e,(e,i)=>{Z=1,e.length>1?SBF.ajax({function:"search-conversations",search:e,routing:SB_ADMIN_SETTINGS.routing},e=>{bt.populateList(e),t(i).sbLoading(!1),this.scrollTo(),this.is_search=!0}):(Q=1,SBF.ajax({function:"get-conversations",status_code:v.find(".sb-select li.sb-active").data("value"),routing:SB_ADMIN_SETTINGS.routing},e=>{bt.populateList(e),t(i).sbLoading(!1),this.is_search=!1}))})},updateCurrentURL:function(){if(SBChat.user_online&&0!=i()){let t=b.find('.sb-profile-list [data-id="current_url"] label');t.length&&SBF.ajax({function:"current-url"},e=>{0!=e&&t.attr("data-value",e).html(e.replace("https://","").replace("http://","").replace(/\/$/,""))})}},showDialogflowIntent:function(t){pt.dialogflow.showCreateIntentBox(t)},sendDialogflowIntent:function(t){pt.dialogflow.submitIntent(t)},assignDepartment:function(t,e,i){SBF.ajax({function:"update-conversation-department",conversation_id:t,department:e,message:SBChat.conversation.getLastMessage().message},t=>{i(t)})},assignAgent:function(t,e,i=!1){SBF.ajax({function:"update-conversation-agent",conversation_id:t,agent_id:e,message:SBChat.conversation.getLastMessage().message},t=>{i&&i(t)})},setActiveDepartment:function(t){let i=b.find("#conversation-department"),a=i.find(`[data-id="${t}"]`);i.find(" > p").attr("data-value",a.data("value")).html(a.html()).next().sbActive(!1),"agent"==SB_ACTIVE_AGENT.user_type&&SB_ACTIVE_AGENT.department&&SB_ACTIVE_AGENT.department!=t&&(m.find(`[data-conversation-id="${SBChat.conversation.id}"]`).remove(),bt.clickFirst()),e("Department updated. The agents have been notified.")},setActiveAgent:function(t){let i=b.find("#conversation-agent"),a=i.find(`[data-id="${t}"]`);SBChat.conversation.set("agent_id",t),i.find(" > p").attr("data-value",a.data("value")).html(a.html()).next().sbActive(!1),"agent"!=SB_ACTIVE_AGENT.user_type||SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&!t||(m.find(`[data-conversation-id="${SBChat.conversation.id}"]`).remove(),bt.clickFirst()),t&&e("Agent assigned. The agent has been notified.")},mobileOpenConversation:function(){b.find(".sb-admin-list").sbActive(!1),b.find(".sb-conversation").sbActive(!0),g.addClass("sb-hide")},mobileCloseConversation:function(){m.find("li.sb-active").sbActive(!1),b.find(".sb-admin-list").sbActive(!0),b.find(".sb-conversation").sbActive(!1),g.removeClass("sb-hide"),window.history.replaceState({},document.title,SBF.URL())},clickFirst:function(){m.find("li:first-child").length?(m.find("li:first-child").click(),bt.scrollTo()):b.find(".sb-board").addClass("sb-no-conversation")},savedReplies:function(e,i){let a=i.charAt(e.selectionStart-1);if("#"==a&&(SBChat.editor_listening=!0),SBChat.editor_listening&&" "==a){let a=i.substr(i.lastIndexOf("#")+1).replace(" ","");SBChat.editor_listening=!1;for(var s=0;s<X.length;s++)if(X[s]["reply-name"]==a)return void t(e).val(i.substr(0,i.lastIndexOf("#"))+X[s]["reply-text"])}},attachments:function(){if(_.length){let i=SBChat.conversation.getAttachments(),a="";for(var e=0;e<i.length;e++)a+=`<a href="${i[e][1]}" target="_blank"><i class="sb-icon sb-icon-download"></i>${i[e][0]}</a>`;t(_).html(""==a?"":`<h3>${o("Attachments")}</h3><div class="sb-list-items sb-list-links sb-list-icon">${a}</div>`),l(_,160)}},notes:{busy:!1,add:function(t,e,i,a,s=!1){SBF.ajax({function:"add-note",conversation_id:t,user_id:e,name:i,message:a},t=>{s&&s(t)})},update:function(t,e=!1){if(S.length){let a="",s=S.find(" > div");for(var i=0;i<t.length;i++){let e=t[i];a+=`<div data-id="${e.id}"><span>${e.name}${SB_ACTIVE_AGENT.id==e.user_id?'<i class="sb-delete-note sb-icon-close"></i>':""}</span><span>${e.message}</span></div>`}e?s.append(a):s.html(a),s.attr("style",""),S.find(".sb-collapse-btn").remove(),l(S,155),this.busy=!1}},delete:function(t,e,i=!1){this.busy||(this.busy=!0,SBF.ajax({function:"delete-note",conversation_id:t,note_id:e},t=>{this.busy=!1,i&&i(t)}))}},showDirectMessageBox:function(t,e=[]){let i="email"==t;SBForm.clear(B),B.find(".sb-direct-message-users").val(e.length?e.join(","):"all"),B.find(".sb-bottom > div").html(""),B.find(".sb-top-bar > div:first-child").html(o(`Send ${"sms"==t?"text message":t}`)),B.find(".sb-loading").sbLoading(!1),B.find(".sb-direct-message-subject").sbActive(i).find("input").attr("required",i),B.attr("data-type",t),B.sbShowLightbox()}},vt={getAll:function(t){return SBForm.getAll(t)},get:function(t){return SBForm.get(t)},set:function(t,e){return SBForm.set(t,e)},show:function(t){s(),i(new SBUser({id:t})),i().update(()=>{this.populate(i(),C.find(".sb-profile-list")),C.find(".sb-profile").setProfile(),i().getConversations(e=>{let a=i().type;SBF.isAgent(a)&&this.agentData(),C.find(".sb-user-conversations").html(i().getConversationsCode(e)),C.find(".sb-top-bar [data-value]").sbActive(!1),SBF.null(i().get("email"))||C.find(".sb-top-bar [data-value=email]").sbActive(!0),i().getExtra("phone")&&SB_ADMIN_SETTINGS.sms&&C.find(".sb-top-bar [data-value=sms]").sbActive(!0),this.boxClasses(C,a),C.attr("data-user-id",i().id).sbShowLightbox(),s(!1,!1),SBF.event("SBProfileBoxOpened",{user_id:t})}),tt[t]=i(),SBF.getURL("user")!=t&&u("?user="+t)})},showEdit:function(t){if(!(t instanceof SBUser))return SBF.error("User not of type SBUser","SBUsers.showEdit"),!1;{let i=T.find("#password input"),a=t.type,s=T.find("#user_type select"),n=T.find("#email input");T.removeClass("sb-user-new").attr("data-user-id",t.id),T.find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Save changes")}`),T.find(".sb-profile").setProfile(),T.find(".sb-custom-detail").remove(),T.find("input,select,textara").removeClass("sb-error");let r="",l=T.find(".sb-additional-details [id]").map(function(){return this.id}).get().concat(["wp-id","perfex-id","whmcs-id","aecommerce-id","facebook-id","ip","os","current_url","country_code","browser_language","browser"]);for(var e in t.extra)l.includes(e)||(r+=`<div id="${e}" data-type="text" class="sb-input sb-custom-detail"><span>${o(t.extra[e].name)}</span><input type="text"></div>`);T.find(".sb-additional-details .sb-edit-box").append(r),this.populateEdit(t,T),SBF.isAgent(a)?(n.prop("required",!0),i.prop("required",!0)):(n.removeAttr("required"),i.removeAttr("required")),"admin"==SB_ACTIVE_AGENT.user_type&&SBF.isAgent(a)&&s.html(`<option value="agent">${o("Agent")}</option><option value="admin"${"admin"==a?" selected":""}>${o("Admin")}</option>`),i.val()&&i.val("********"),SB_ADMIN_SETTINGS.cloud&&T.setClass("sb-cloud-admin",SB_ADMIN_SETTINGS.cloud.id==t.id),this.boxClasses(T,a),T.sbShowLightbox(),SBF.event("SBProfileEditBoxOpened",{user_id:t.id})}},populate:function(t,e){let i=["first_name","last_name","password","profile_image"],a="";if(e.hasClass("sb-profile-list-conversation")&&SBChat.conversation){let t=SBChat.conversation.get("source");a=this.profileRow("conversation-id",SBChat.conversation.id,o("Conversation ID")),SBF.null(t)||(a+=this.profileRow("conversation-source","fb"==t?"Facebook":"wa"==t?"WhatsApp":"tm"==t?"Text message":"ig"==t?"Instagram":"tg"==t?"Telegram":"tk"==t?"Tickets":"wc"==t?"WeChat":t,o("Source")))}"admin"!=SB_ACTIVE_AGENT.user_type&&i.push("token");for(var s in t.details)i.includes(s)||(a+=this.profileRow(s,t.get(s)));if(t.isExtraEmpty())SBF.ajax({function:"get-user-extra",user_id:t.id},i=>{for(var s=0;s<i.length;s++){let e=i[s].slug;t.setExtra(e,i[s]),a+=this.profileRow(e,i[s].value,i[s].name)}e.html(`<ul>${a}</ul>`),l(e,145)});else{for(var s in t.extra){let e=t.getExtra(s);a+=this.profileRow(s,e.value,e.name)}e.html(`<ul>${a}</ul>`),l(e,145)}},profileRow:function(t,e,i=t){if(""==e)return"";let a,s={id:"padlock","conversation-id":"padlock",full_name:"user",email:"envelope",phone:"phone",user_type:"user",last_activity:"calendar",creation_time:"calendar",token:"shuffle",currency:"currency",location:"marker",country:"marker",address:"marker",city:"marker",postal_code:"marker",os:"desktop",current_url:"next",timezone:"clock"},n=`<i class="sb-icon sb-icon-${t in s?s[t]:"plane"}"></i>`,r=!1;switch(t){case"last_activity":case"creation_time":e=SBF.beautifyTime(e);break;case"user_type":e=SBF.slugToString(e);break;case"country_code":case"language":case"browser_language":n=`<img src="${SB_URL}/media/flags/${e.toLowerCase()}.png" />`;break;case"browser":(a=e.toLowerCase()).includes("chrome")?r="chrome":a.includes("edge")?r="edge":a.includes("firefox")?r="firefox":a.includes("opera")?r="opera":a.includes("safari")&&(r="safari");break;case"os":(a=e.toLowerCase()).includes("windows")?r="windows":a.includes("mac")||a.includes("apple")||a.includes("ipad")||a.includes("iphone")?r="apple":a.includes("android")?r="android":a.includes("linux")?r="linux":a.includes("ubuntu")&&(r="ubuntu");break;case"conversation-source":r=e.toLowerCase();case"browser":case"os":case"conversation-source":r&&(n=`<img src="${SB_URL}/media/${"conversation-source"==t?"apps":"devices"}/${r}.svg" />`)}return`<li data-id="${t}">${n}<span>${o(SBF.slugToString(i))}</span><label>${e}</label></li>`},populateEdit:function(e,i){i.find(".sb-details .sb-input").each((i,a)=>{this.set(a,e.details[t(a).attr("id")])}),i.find(".sb-additional-details .sb-input").each((i,a)=>{let s=t(a).attr("id");s in e.extra?this.set(a,e.extra[s].value):this.set(a,"")})},clear:function(t){SBForm.clear(t)},errors:function(t){return SBForm.errors(t.find(".sb-details"))},showErrorMessage:function(t,e){SBForm.showErrorMessage(t,e)},agentData:function(){let t=`<div class="sb-title">${o("Feedback rating")}</div><div class="sb-rating-area sb-loading"></div>`,e=C.find(".sb-agent-area");e.html(t),SBF.ajax({function:"get-rating"},i=>{if(0==i[0]&&0==i[1])t=`<p class="sb-no-results">${o("No ratings yet.")}</p>`;else{let e=i[0]+i[1],a=100*i[0]/e,s=100*i[1]/e;t=`<div><div>${o("Helpful")}</div><span data-count="${i[0]}" style="width: ${Math.round(2*a)}px"></span><div>${a.toFixed(2)} %</div></div><div><div>${o("Not helpful")}</div><span data-count="${i[1]}" style="width: ${Math.round(2*s)}px"></span><div>${s.toFixed(2)} %</div></div><p class="sb-rating-count">${e} ${o("Ratings")}</p>`}e.find(".sb-rating-area").html(t).sbLoading(!1)})},boxClasses:function(e,i=!1){t(e).removeClass("sb-type-admin sb-type-agent sb-type-lead sb-type-user sb-type-visitor").addClass(`${0!=i?`sb-type-${i}`:""} sb-agent-${SB_ACTIVE_AGENT.user_type}`)}},mt={dialog:a,open_popup:!1,must_translate:!1,is_logout:!1,conversations:bt,users:gt,settings:ht,profile:vt,apps:pt};window.SBAdmin=mt,t(document).ready(function(){function l(t,i,s=0,n=[],r,c=!1){let d="custom-email"==r?["send-custom-email","emails"," users with an email","direct-emails"]:"sms"==r?["send-sms","text messages"," with a phone number","direct-sms"]:["create-email","emails"," with an email",!1];SBF.ajax({function:d[0],to:t[s].value,recipient_id:t[s].id,sender_name:SB_ACTIVE_AGENT.full_name,sender_profile_image:SB_ACTIVE_AGENT.profile_image,subject:c,message:i,template:!1},u=>{let p=t.length;return B.find(".sb-bottom > div").html(`${o("Sending")} ${d[1]}... ${s+1} / ${p}`),u||console.warn(u),!0!==u&&"status"in u&&400==u.status?(a(`${u.message} Details at ${u.more_info}`,"info"),void console.warn(u)):s<p-1?l(t,i,s+1,n,r,c):(n.length?l(n,i,0,[],"sms",!1):(f.sbHideLightbox(),d[3]&&SBF.ajax({function:"reports-update",name:d[3],value:i.substr(0,18)+" | "+p})),void e(1==p?"Message sent":`${SBF.slugToString(d[1])} sent to all users${d[2]}.`))})}if(f=t(".sb-admin"),g=f.find("> .sb-header"),b=f.find(".sb-area-conversations"),v=b.find(".sb-admin-list"),m=v.find(".sb-scroll-area ul"),x=f.find(".sb-area-users"),k=x.find(".sb-table-users"),A=x.find(".sb-menu-users"),C=f.find(".sb-profile-box"),T=f.find(".sb-profile-edit-box"),$=f.find(".sb-area-settings"),E=$.find(".sb-automations-area"),R=E.find(".sb-conditions"),N=E.find(" > .sb-select"),M=E.find(" > .sb-tab > .sb-nav > ul"),D=f.find(".sb-area-reports"),F=$.find(".sb-articles-area"),I=F.find(".sb-article-categories select"),L=F.find(".sb-article-parent-category select"),z=b.find(".sb-replies"),q=f.find(".sb-lightbox-overlay"),W=typeof SB_URL!=dt?SB_URL.substr(0,SB_URL.indexOf("-content")-3):"",Y=b.find(".sb-woocommerce-products"),K=Y.find(" > div > ul"),S=b.find(".sb-panel-notes"),_=b.find(".sb-panel-attachments"),B=f.find(".sb-direct-message-box"),ut=pt.is("wordpress")&&t(".wp-admin").length,y=f.find(".sb-dialogflow-intent-box"),w=b.find(".sb-editor > .sb-suggestions"),window.onpopstate=function(){SBF.getURL("user")?(x.sbActive()||g.find(".sb-admin-nav #sb-users").click(),vt.show(SBF.getURL("user"))):SBF.getURL("area")?g.find(".sb-admin-nav #sb-"+SBF.getURL("area")).click():SBF.getURL("conversation")?(b.sbActive()||g.find(".sb-admin-nav #sb-conversations").click(),bt.openConversation(SBF.getURL("conversation"))):SBF.getURL("setting")?($.sbActive()||g.find(".sb-admin-nav #sb-settings").click(),$.find("#tab-"+SBF.getURL("setting")).click()):SBF.getURL("report")&&(D.sbActive()||g.find(".sb-admin-nav #sb-reports").click(),D.find("#"+SBF.getURL("report")).click())},SBF.getURL("area")&&setTimeout(()=>{g.find(".sb-admin-nav #sb-"+SBF.getURL("area")).click()},300),typeof SB_ADMIN_SETTINGS!=dt)f.length&&(s(),f.removeAttr("style"),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone||document.referrer.includes("android-app://"))&&f.addClass("sb-pwa"),pt.is("woocommerce")&&(Y=b.find(".sb-woocommerce-products"),K=Y.find(" > div > ul")),nt&&r(),f.find(" > .sb-rich-login").length||(SB_ADMIN_SETTINGS.pusher?(SBPusher.active=!0,SBPusher.init(()=>{SBPusher.presence(1,()=>{gt.updateUsersActivity()}),SBPusher.event("update-conversations",()=>{bt.update()},"agents"),SBPusher.event("set-agent-status",t=>{t.agent_id==SB_ACTIVE_AGENT.id&&gt.setActiveAgentStatus("online"==t.status)},"agents"),h()})):(h(),setInterval(function(){gt.updateUsersActivity()},1e4)),gt.table_extra=k.find("th[data-extra]").map(function(){return t(this).attr("data-field")}).get(),t(window).on("beforeunload",function(){i()&&SBF.ajax({function:"on-close"})}),t(window).keydown(function(t){let e=t.which,a=!1;if([13,27,37,38,39,40,46].includes(e)){if(f.find(".sb-dialog-box").sbActive()){let t=f.find(".sb-dialog-box");switch(e){case 46:case 27:t.find(".sb-cancel").click();break;case 13:t.find("info"!=t.attr("data-type")?".sb-confirm":".sb-close").click()}a=!0}else if([38,40,46].includes(e)&&b.sbActive()){if(46==e){if(b.find(".sb-editor textarea").is(":focus"))return;let t=b.find(" > div > .sb-conversation");t.find('.sb-top [data-value="'+(3==t.attr("data-conversation-status")?"delete":"archive")+'"]').click()}else if(t.ctrlKey){let t=m.find(".sb-active");40==e?t.next().click():t.prev().click(),bt.scrollTo()}a=!0}else if([37,39].includes(e)&&x.sbActive()&&f.find(".sb-lightbox").sbActive()){let t=k.find(`[data-user-id="${i().id}"]`);(t=39==e?t.next():t.prev()).length&&(f.sbHideLightbox(),vt.show(t.attr("data-user-id"))),a=!0}else if([46,27].includes(e))if(f.find(".sb-lightbox").sbActive())f.sbHideLightbox(),a=!0;else{let t=f.find(".sb-search-btn.sb-active");t.length&&(t.find("i").click(),a=!0)}a&&t.preventDefault()}}),t(document).on("click keydown mousemove",function(){SBF.debounce(function(){SBChat.tab_active||SBF.visibilityChange(),SBChat.tab_active=!0,clearTimeout(ct),ct=setTimeout(()=>{SBChat.tab_active=!1},1e4)},"#3",8e3)}),t(g).on("click",".sb-version",function(){let t=f.find(".sb-updates-box");SBF.ajax({function:"get-versions"},e=>{let i="",a={sb:"Support Board",slack:"Slack",dialogflow:"Dialogflow",tickets:"Tickets",woocommerce:"Woocommerce",ump:"Ultimate Membership Pro",perfex:"Perfex",whmcs:"WHMCS",aecommerce:"Active eCommerce",messenger:"Messenger",whatsapp:"WhatsApp",armember:"ARMember",telegram:"Telegram",wechat:"WeChat"},n=!1;for(var r in e)if(pt.is(r)){let t=SB_VERSIONS[r]==e[r];t||(n=!0),i+=`<div class="sb-input"><span>${a[r]}</span><div${t?' class="sb-green"':""}>${o(t?"You are running the latest version.":"Update available! Please update now.")} ${o("Your version is")} V ${SB_VERSIONS[r]}.</div></div>`}n?t.find(".sb-update").removeClass("sb-hide"):t.find(".sb-update").addClass("sb-hide"),s(!1),t.find(".sb-main").prepend(i),t.sbShowLightbox()}),s(!0),t.sbActive(!1),t.find(".sb-input").remove()}),t(f).on("click",".sb-updates-box .sb-update",function(){if(n(this))return;let i=f.find(".sb-updates-box");SBF.ajax({function:"update",domain:SB_URL},a=>{let s="";if(SBF.errorValidation(a,"envato-purchase-code-not-found"))s="Please go to Settings > Miscellaneous and insert the Envato Purchase Code of Support Board.";else if(SBF.errorValidation(a))s=SBF.slugToString(a[1]);else{let t=!0;for(var n in a)if("success"!=a[n]){t=!1;break}t||(s=JSON.stringify(a))}""==s?(r(),e("Update completed."),location.reload()):SBForm.showErrorMessage(i,s),t(this).sbLoading(!1)})}),setTimeout(function(){let t=SBF.storage("last-update-check"),i=[ot.getMonth(),ot.getDate()];SB_ADMIN_SETTINGS.cloud||(0==t||i[0]!=t[0]||i[1]>t[1]+10)&&(SBF.storage("last-update-check",i),SB_ADMIN_SETTINGS["auto-updates"]?SBF.ajax({function:"update",domain:SB_URL},t=>{"string"==typeof t||Array.isArray(t)||(e("Automatic update completed. Reload the admin area to apply the update."),r())}):"admin"==SB_ACTIVE_AGENT.user_type&&SBF.ajax({function:"updates-available"},t=>{!0===t&&e(`${o("Update available.")} <span onclick="$('.sb-version').click()">${o("Click here to update now")}</span>`,"info")}))},1e3),t(f).on("click",".sb-apps > div",function(){let e=f.find(".sb-app-box"),i=t(this).data("app"),a="?utm_source=plugin&utm_medium=admin_area&utm_campaign=plugin";SBF.ajax({function:"app-get-key",app_name:i},t=>{e.find("input").val(t)}),e.find("input").val(""),e.find(".sb-top-bar > div:first-child").html(t(this).find("h2").html()),e.find("p").html(t(this).find("p").html()),e.attr("data-app",i),e.find(".sb-btn-app-setting").sbActive(pt.is(i)),e.find(".sb-btn-app-puchase").attr("href","https://board.support/shop/"+i+a),e.find(".sb-btn-app-details").attr("href","https://board.support/"+i+a),e.sbShowLightbox()}),t(f).on("click",".sb-app-box .sb-activate",function(){let i=f.find(".sb-app-box"),a=i.find("input").val(),s=i.attr("data-app");if(a){if(n(this))return;SBF.ajax({function:"app-activation",app_name:s,key:a},a=>{if(SBF.errorValidation(a)){let e="";e="envato-purchase-code-not-found"==(a=a[1])?"Please go to Settings > Miscellaneous and insert the Envato Purchase Code of Support Board.":"invalid-key"==a?"It looks like your license key is invalid. If you believe this is an error, please contact support.":"expired"==a?`Your license key is expired. Please purchase a new license <a href="https://board.support/shop/${s}" target="_blank"> here</a>.`:"Error: "+a,SBForm.showErrorMessage(i,e),t(this).sbLoading(!1)}else e("Activation complete! Page reload in progress..."),setTimeout(function(){location.reload()},1e3)})}else SBForm.showErrorMessage(i,"Please insert the license key.")}),t(f).on("click",".sb-app-box .sb-btn-app-setting",function(){$.find("#tab-"+t(this).closest("[data-app]").attr("data-app")).click(),f.sbHideLightbox()}),typeof Notification===dt||"all"!=SB_ADMIN_SETTINGS["desktop-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["desktop-notifications"]||SB_ADMIN_SETTINGS["push-notifications"]||(bt.desktop_notifications=!0),"all"!=SB_ADMIN_SETTINGS["flash-notifications"]&&"agents"!=SB_ADMIN_SETTINGS["flash-notifications"]||(bt.flash_notifications=!0),ot.getDate()!=SBF.storage("admin-clean")&&setTimeout(function(){SBF.ajax({function:"cron-jobs"}),SBF.storage("admin-clean",ot.getDate())},1e4),t(f).on("click",".sb-collapse-btn",function(){let e=t(this).sbActive(),i=e?t(this).parent().data("height")+"px":"";t(this).html(o(e?"View more":"Close")),t(this).parent().find(" > div, > ul").css({height:i,"max-height":i}),t(this).sbActive(!e)}),t(f).on("click",".sb-popup-close",function(){f.sbHideLightbox()}),at&&(t(f).on("click",".sb-menu-mobile > i",function(){t(this).toggleClass("sb-active"),mt.open_popup=t(this).parent()}),t(f).on("click",".sb-menu-mobile a",function(){t(this).closest(".sb-menu-mobile").find(" > i").sbActive(!1)}),t(f).on("click",".sb-menu-wide,.sb-nav",function(){t(this).toggleClass("sb-active")}),t(f).on("click",".sb-menu-wide > ul > li, .sb-nav > ul > li",function(e){let i=t(this).parent().parent();return i.find("li").sbActive(!1),i.find("> div:not(.sb-menu-wide):not(.sb-btn)").html(t(this).html()),i.sbActive(!1),i.find("> .sb-menu-wide").length&&i.closest(".sb-scroll-area").scrollTop(i.next()[0].offsetTop-(f.hasClass("sb-header-hidden")?70:130)),e.preventDefault(),!1}),t(f).find(".sb-admin-list .sb-scroll-area, main > div > .sb-scroll-area,.sb-area-settings > .sb-tab > .sb-scroll-area,.sb-area-reports > .sb-tab > .sb-scroll-area").on("scroll",function(){let e=t(this).scrollTop();st.last<e-10&&st.header?(f.addClass("sb-header-hidden"),st.header=!1):st.last>e+10&&!st.header&&!st.always_hidden&&(f.removeClass("sb-header-hidden"),st.header=!0),st.last=e}),t(f).on("click",".sb-search-btn i",function(){t(this).parent().sbActive()?(f.addClass("sb-header-hidden"),st.always_hidden=!0):(st.always_hidden=!1,m.parent().scrollTop()<10&&f.removeClass("sb-header-hidden"))}),t(f).on("click",".sb-top .sb-btn-back",function(){bt.mobileCloseConversation()}),t(k).find("th:first-child").html(o("Order by")),t(k).on("click","th:first-child",function(){t(this).parent().toggleClass("sb-active")})),t(g).on("click"," .sb-admin-nav a",function(){let e=t(this).attr("id");switch(g.find(".sb-admin-nav a").sbActive(!1),f.find(" > main > div").sbActive(!1).eq(t(this).index()).sbActive(!0),t(this).sbActive(!0),SBF.deactivateAll(),e){case"sb-conversations":at||SBF.getURL("conversation")||bt.clickFirst(),bt.update(),bt.startRealTime(),gt.stopRealTime();break;case"sb-users":gt.startRealTime(),bt.stopRealTime(),gt.init||(s(),et=1,it=1,SBF.ajax({function:"get-users",user_types:["user","visitor","lead"],extra:gt.table_extra},t=>{gt.populate(t),gt.updateMenu(),gt.init=!0,gt.datetime_last_user=SBF.dateDB("now"),s(!1)}));break;case"sb-settings":ht.init||(s(),SBF.ajax({function:"get-all-settings"},t=>{let e=t["external-settings-translations"];ht.initHTML(t),ht.translations.translations=Array.isArray(e)&&!e.length?{}:e,delete t["external-settings-translations"];for(var i in t)ht.set(i,t[i]);ht.initPlugins(),ht.init=!0,s(!1)})),gt.stopRealTime(),bt.stopRealTime();break;case"sb-reports":D.sbLoading()&&t.getScript(SB_URL+"/vendor/moment.min.js",()=>{t.getScript(SB_URL+"/vendor/daterangepicker.min.js",()=>{t.getScript(SB_URL+"/vendor/chart.min.js",()=>{ft.initDatePicker(),ft.initReport("conversations"),D.sbLoading(!1)})})}),gt.stopRealTime(),bt.stopRealTime()}let i=e.substr(3);SBF.getURL("area")!=i&&("conversations"==i&&!SBF.getURL("conversation")||"users"==i&&!SBF.getURL("user")||"settings"==i&&!SBF.getURL("setting")||"reports"==i&&!SBF.getURL("report"))&&u("?area="+i)}),t(g).on("click",".sb-profile",function(){t(this).next().toggleClass("sb-active")}),t(g).on("click",'[data-value="logout"],.logout',function(){mt.is_logout=!0,SBF.ajax({function:"on-close"}),gt.stopRealTime(),bt.stopRealTime(),SBF.logout()}),t(g).on("click",'[data-value="edit-profile"],.edit-profile',function(){s();let t=new SBUser({id:SB_ACTIVE_AGENT.id});t.update(()=>{i(t),b.find(".sb-board").addClass("sb-no-conversation"),m.find(".sb-active").sbActive(!1),vt.showEdit(t)})}),t(g).on("click",'[data-value="status"]',function(){gt.setActiveAgentStatus(!t(this).hasClass("sb-online"))}),t(g).find(".sb-account").setProfile(SB_ACTIVE_AGENT.full_name,SB_ACTIVE_AGENT.profile_image),t(m).on("click","li",function(){bt.openConversation(t(this).attr("data-conversation-id"),t(this).attr("data-user-id"),!1),SBF.deactivateAll()}),t(f).on("click",".sb-user-conversations li",function(){bt.openConversation(t(this).attr("data-conversation-id"),i().id,t(this).attr("data-conversation-status"))}),t(b).on("click",".sb-top ul a",function(){let e=-1,i="The conversation will be ",s=t(this).attr("data-value"),n=SBChat.conversation.id;switch(s){case"inbox":e=0,i+="restored.";break;case"archive":i+="archived.",e=3;break;case"delete":i+="deleted.",e=4;break;case"empty-trash":e=5,i="All conversations in the trash (including their messages) will be deleted permanently.";break;case"transcript":bt.transcript(n,t(this).attr("data-action"));break;case"read":e=0,i+="marked as read."}-1!=e&&a(i,"alert",function(){SBF.ajax({function:"update-conversation-status",conversation_id:n,status_code:e},()=>{if([0,3,4].includes(e))for(var t=0;t<J.length;t++)if(J[t].conversation_id==n){J[t].conversation_status_code=e;break}SB_ADMIN_SETTINGS["close-message"]&&3==e&&(SBF.ajax({function:"close-message",conversation_id:n,bot_id:SB_ADMIN_SETTINGS["bot-id"]}),SB_ADMIN_SETTINGS["close-message-transcript"]&&bt.transcript(n,"email")),"read"==s?(m.find(".sb-active").attr("data-conversation-status",0),b.find('.sb-top [data-value="read"]').sbActive(!1)):(v.find(".sb-select li.sb-active").click(),v.find(".sb-select ul").sbActive(!1))}),SBChat.conversation&&SBChat.conversation.id==n&&SBChat.conversation.set("conversation_status_code",e)})}),SBF.ajax({function:"saved-replies"},t=>{let e=`<p class="sb-no-results">${o("No saved replies found. Add new saved replies via Settings > Miscellaneous.")}</p>`;if(Array.isArray(t)&&t.length>0&&t[0]["reply-name"]){e="",X=t;for(var i=0;i<t.length;i++)e+=`<li><div>${t[i]["reply-name"]}</div><div>${t[i]["reply-text"]}</div></li>`}z.find(".sb-replies-list > ul").html(e).sbLoading(!1)}),t(b).on("click",".sb-btn-saved-replies",function(){z.sbTogglePopup(this)}),t(z).on("click",".sb-replies-list li",function(){SBChat.insertText(t(this).find("div:last-child").html()),SBF.deactivateAll(),f.removeClass("sb-popup-active")}),t(z).on("input",".sb-search-btn input",function(){let e=t(this).val().toLowerCase();SBF.search(e,()=>{let t="",i=!(e.length>1);for(var a=0;a<X.length;a++)(i||X[a]["reply-name"].toLowerCase().includes(e)||X[a]["reply-text"].toLowerCase().includes(e))&&(t+=`<li><div>${X[a]["reply-name"]}</div><div>${X[a]["reply-text"]}</div></li>`);z.find(".sb-replies-list > ul").html(t)})}),t(v).find(".sb-scroll-area").on("scroll",function(){if(!rt&&!bt.is_search&&d(this,!0)&&Z){let t=b.find(".sb-admin-list");rt=!0,t.append('<div class="sb-loading-global sb-loading"></div>'),SBF.ajax({function:"get-conversations",pagination:Q,status_code:t.find(" > .sb-top > .sb-select p").attr("data-value"),routing:SB_ADMIN_SETTINGS.routing,routing_unassigned:SB_ADMIN_SETTINGS["assign-conversation-to-agent"]},e=>{if(setTimeout(()=>{rt=!1},500),Z=e.length){let t="";for(var i=0;i<Z;i++)t+=bt.getListCode(e[i]),J.push(e[i]);Q++,m.append(t),d(this,!1,1e3)}t.find(" > .sb-loading").remove(),SBF.event("SBAdminConversationsLoaded",{conversations:e})})}}),t(document).on("SBMessageDeleted",function(){let t=SBChat.conversation.getLastMessage();0!=t?m.find("li.sb-active p").html(t.message):(m.find("li.sb-active").remove(),bt.clickFirst(),bt.scrollTo())}),t(document).on("SBMessageSent",function(e,s){let n=s.conversation_id,r=m.find(`[data-conversation-id="${n}"]`),l=o("Error. Message not sent to");s.message&&r.find("p").html(s.message),-1!=s.conversation_status_code&&(r.attr("data-conversation-status",s.conversation_status_code),bt.updateMenu()),pt.messenger.check(SBChat.conversation)&&pt.messenger.send(i().getExtra("facebook-id").value,SBChat.conversation.get("extra"),s.message,s.attachments,s.message_id,t=>{t&&"error"in t&&a(l+" Messenger: "+t.error.message,"info")}),pt.whatsapp.check(SBChat.conversation)&&pt.whatsapp.send(pt.whatsapp.activeUserPhone(),s.message,s.attachments,t=>{"ErrorCode"in t&&a(l+" WhatsApp: "+t.errorMessage,"info")}),pt.telegram.check(SBChat.conversation)&&pt.telegram.send(SBChat.conversation.get("extra"),s.message,s.attachments,t=>{"ok"in t&&t.ok||a(l+" Telegram: "+JSON.stringify(t),"info")}),pt.wechat.check(SBChat.conversation)&&pt.wechat.send(i().getExtra("wechat-id").value,s.message,s.attachments,t=>{t&&"ok"==t.errmsg||a(l+" WeChat: "+JSON.stringify(t),"info")}),SB_ADMIN_SETTINGS["smart-reply"]&&w.html(""),SB_ADMIN_SETTINGS["assign-conversation-to-agent"]&&SBChat.conversation&&SBChat.conversation.id==n&&SBF.null(SBChat.conversation.get("agent_id"))&&bt.assignAgent(n,SB_ACTIVE_AGENT.id,()=>{SBChat.conversation.set("agent_id",SB_ACTIVE_AGENT.id),t(b).find("#conversation-agent > p").attr("data-value",SB_ACTIVE_AGENT.id).html(SB_ACTIVE_AGENT.full_name)})}),t(document).on("SBNewMessagesReceived",function(t,i){let s=i.get("payload"),n=b.find(".sb-conversation"),r=SBF.isAgent(i.get("user_type"));if(setTimeout(function(){n.find(".sb-top .sb-status-typing").remove()},300),SB_ADMIN_SETTINGS["smart-reply"]&&(r?SB_ADMIN_SETTINGS["smart-reply-agent-assistant"]&&pt.dialogflow.smartReplyUpdate(i.message):pt.dialogflow.smartReply(i.message)),mt.must_translate){let t=n.find(`[data-id="${i.id}"] .sb-message`),e=n.find(`[data-id="${i.id}"] .sb-menu`);"original-message"in s?(t.html(s["original-message"]),e.prepend(`<li data-value="original">${o("View translation")}</li>`),SBChat.conversation.getMessage(i.id).set("translation",s["original-message"])):pt.dialogflow.translate([i.message],SB_ADMIN_SETTINGS["active-agent-language"],a=>{a&&(t.html(a[0].translatedText),e.prepend(`<li data-value="original">${o("View original message")}</li>`),SBChat.conversation.getMessage(i.id).set("translation",a[0].translatedText))})}if("queryResult"in s&&"fulfillmentMessages"in s.queryResult){let t=s.queryResult.fulfillmentMessages;for(var l=0;l<t.length;l++)if("payload"in t[l]){let e=t[l].payload;if("department"in e){bt.setActiveDepartment(e.department);break}if("agent"in e){bt.setActiveAgent(e.agent);break}}}"ErrorCode"in s&&a("Error. Message not sent to WhatsApp. Error message: "+s.ErrorMessage,"info"),"whatsapp-fallback"in s&&e(`Message sent as text message.${"whatsapp-template-fallback"in s?" The user has been notified via WhatsApp Template notification.":""}`),"whatsapp-template-fallback"in s&&!("whatsapp-fallback"in s)&&e("The user has been notified via WhatsApp Template notification."),r||SBChat.conversation.id!=i.get("conversation_id")||SBChat.user_online||gt.setActiveUserStatus(),bt.update()}),t(document).on("SBNewConversationCreated",function(){bt.update()}),t(document).on("SBEmailSent",function(){e("The user has been notified by email.")}),t(document).on("SBSMSSent",function(){e("The user has been notified by text message.")}),t(document).on("SBNotificationsSent",function(t,i){e(`The user has been notified by email${i.includes("sms")?" and text message":""}.`)}),t(document).on("SBTyping",function(t,e){bt.typing(e)}),t(v).on("input",".sb-search-btn input",function(){bt.search(this)}),t(b).on("click",".sb-admin-list .sb-search-btn i",function(){SBF.searchClear(this,()=>{bt.search(t(this).next())})}),t(b).on("click",".sb-admin-list .sb-select li",function(){let e=m.parent(),i=t(this).data("value");n(e)||(Q=1,Z=1,SBF.ajax({function:"get-conversations",status_code:i,routing:SB_ADMIN_SETTINGS.routing,routing_unassigned:SB_ADMIN_SETTINGS["assign-conversation-to-agent"]},t=>{if(bt.populateList(t),b.find(".sb-conversation").attr("data-conversation-status",i),t.length){if(!at){if(0!=SBChat.conversation){let t=m.find(`[data-conversation-id="${SBChat.conversation.id}"]`);t.length?t.sbActive(!0):i==SBChat.conversation.get("conversation_status_code")?m.prepend(bt.getListCode(SBChat.conversation).replace("<li",'<li class="sb-active"')):bt.clickFirst()}else bt.clickFirst();bt.scrollTo()}}else b.find(".sb-board").addClass("sb-no-conversation"),SBChat.conversation=!1;e.sbLoading(!1)}))}),t(b).on("click",".sb-user-details .sb-scroll-area > .sb-profile,.sb-top > a",function(){let t=m.find(".sb-active").attr("data-user-id");i().id!=t&&i(tt[t]),vt.show(i().id)}),t(f).on("click",'.sb-profile-list [data-id="location"]',function(){a('<iframe src="https://maps.google.com/maps?q='+t(this).find("label").html().replace(", ","+")+'&output=embed"></iframe>',"map")}),t(f).on("click",'.sb-profile-list [data-id="timezone"]',function(){SBF.getLocationTimeString(i().extra,t=>{s(!1),a(t,"info")})}),t(f).on("click",'.sb-profile-list [data-id="current_url"]',function(){let e=t(this).find("label");window.open(SBF.null(e.attr("data-value"))?e.html():e.attr("data-value"))}),t(f).on("click",'.sb-profile-list [data-id="conversation-source"]',function(){let e=t(this).find("label").html().toLowerCase();"whatsapp"==e&&i().getExtra("phone")?window.open("https://wa.me/"+pt.whatsapp.activeUserPhone()):"facebook"==e?window.open("https://www.facebook.com/messages/t/"+SBChat.conversation.get("extra")):"instagram"==e?window.open("https://www.instagram.com/direct/inbox/"):"telegram"==e&&window.open("https://t.me/"+i().getExtra("telegram-id").value)}),t(f).on("click",'.sb-profile-list [data-id="wp-id"]',function(){window.open(window.location.href.substr(0,window.location.href.lastIndexOf("/"))+"/user-edit.php?user_id="+i().getExtra("wp-id").value)}),t(b).on("click",'.sb-menu [data-value="bot"]',function(){pt.dialogflow.showCreateIntentBox(t(this).closest("[data-id]").attr("data-id"))}),t(y).on("click",'.sb-intent-add [data-value="add"]',function(){y.find("> div > .sb-type-text").last().after('<div class="sb-input-setting sb-type-text"><input type="text"></div>')}),t(y).on("click",'.sb-intent-add [data-value="previous"],.sb-intent-add [data-value="next"]',function(){let e=y.find(".sb-first input"),i=e.val(),a="next"==t(this).attr("data-value"),s=SBChat.conversation.getUserMessages(),n=s.length;for(var o=0;o<n;o++)if(s[o].message==i&&(a&&o<n-1||!a&&o>0)){o+=a?1:-1,e.val(s[o].message),y.attr("data-message-id",s[o].id);break}}),t(y).on("click",".sb-send",function(){pt.dialogflow.submitIntent(this)}),t(y).on("input",".sb-search-btn input",function(){pt.dialogflow.searchIntents(t(this).val())}),t(y).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{pt.dialogflow.searchIntents(t(this).val())})}),t(y).on("click","#sb-intent-preview",function(){pt.dialogflow.previewIntent(y.find("#sb-intents-select").val())}),t(y).on("change","#sb-intents-select",function(){y.find(".sb-bot-response").css("opacity",t(this).val()?.5:1)}),t(b).on("click","#conversation-department li",function(e){let i=t(this).parent().parent();return t(this).data("value")==i.find(" > p").attr("data-value")||(0==SBChat.conversation?(t(this).parent().sbActive(!1),e.preventDefault(),!1):(i.sbLoading()||a(`${o("All agents assigned to the new department will be notified. The new department will be")} ${t(this).html()}.`,"alert",()=>{i.sbLoading(!0),bt.assignDepartment(SBChat.conversation.id,t(this).data("id"),()=>{bt.setActiveDepartment(t(this).data("id")),i.sbLoading(!1)})}),e.preventDefault(),!1))}),t(b).on("click","#conversation-agent li",function(e){let i=t(this).parent().parent(),s=t(this).data("id");return s==i.find(" > p").attr("data-value")||s==SB_ACTIVE_AGENT.id||(SBChat.conversation?(i.sbLoading()||a(`${o("The new agent will be")} ${t(this).html()}.`,"alert",()=>{i.sbLoading(!0),bt.assignAgent(SBChat.conversation.id,s,()=>{bt.setActiveAgent(s),i.sbLoading(!1)})}),e.preventDefault(),!1):(t(this).parent().sbActive(!1),e.preventDefault(),!1))}),S.on("click","> i",function(t){return f.find(".sb-notes-box").sbShowLightbox(),t.preventDefault(),!1}),S.on("click",".sb-delete-note",function(){let e=t(this).parents().eq(1);bt.notes.delete(SBChat.conversation.id,e.attr("data-id"),t=>{!0===t?e.remove():SBF.error(t)})}),t(f).on("click",".sb-add-note",function(){let i=t(this).parent().parents().eq(1).find("textarea"),a=i.val();if(0==a.length)SBForm.showErrorMessage(f.find(".sb-notes-box"),"Please write something...");else{if(n(this))return;bt.notes.add(SBChat.conversation.id,SB_ACTIVE_AGENT.id,SB_ACTIVE_AGENT.full_name,a,s=>{Number.isInteger(s)?(t(this).sbLoading(!1),f.sbHideLightbox(),bt.notes.update([{id:s,conversation_id:SBChat.conversation.id,user_id:SB_ACTIVE_AGENT.id,name:SB_ACTIVE_AGENT.full_name,message:a}],!0),i.val(""),e("New note successfully added.")):SBForm.showErrorMessage(s)})}}),t(w).on("click","span",function(){SBChat.insertText(t(this).html()),w.html("")}),t(b).on("click",".sb-list .sb-menu > li",function(){let e=t(this).closest("[data-id]"),i=e.attr("data-id"),a=SBChat.conversation.getMessage(i).get("user_type");switch(t(this).attr("data-value")){case"delete":SBChat.user_online?SBF.ajax({function:"update-message",message_id:i,message:"",attachments:[],payload:{event:"delete-message"}},()=>{SBChat.conversation.deleteMessage(i),e.remove()}):SBChat.deleteMessage(i);break;case"original":e.find(".sb-message").html(SBChat.conversation.getMessage(i).message),t(this).attr("data-value","translation").html(o(SBF.isAgent(a)?"View original message":"View translation"));break;case"translation":e.find(".sb-message").html(SBChat.conversation.getMessage(i).get("translation")),t(this).attr("data-value","original").html(o(SBF.isAgent(a)?"View translation":"View original message"))}}),SBF.getURL("user")&&(g.find(".sb-admin-nav #sb-users").click(),setTimeout(()=>{vt.show(SBF.getURL("user"))},500)),t(k).on("click","th :checkbox",function(){k.find("td :checkbox").prop("checked",t(this).prop("checked"))}),t(k).on("click",":checkbox",function(){let t=x.find('[data-value="delete"]');k.find("td input:checked").length?t.removeAttr("style"):t.hide()}),t(A).on("click","li",function(){gt.filter(t(this).data("type"))}),t(x).on("input",".sb-search-btn input",function(){gt.search(this)}),t(x).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{gt.search(t(this).next())})}),t(k).on("click","th:not(:first-child)",function(){let e=t(this).hasClass("sb-order-asc")?"DESC":"ASC";t(this).toggleClass("sb-order-asc"),t(this).siblings().sbActive(!1),t(this).sbActive(!0),gt.sort(t(this).data("field"),e)}),t(k).parent().on("scroll",function(){!rt&&""==gt.search_query&&d(this,!0)&&it&&(rt=!0,x.append('<div class="sb-loading-global sb-loading sb-loading-pagination"></div>'),SBF.ajax({function:"get-users",pagination:et,sorting:gt.sorting,user_types:gt.user_types,search:gt.search_query,extra:gt.table_extra},t=>{if(setTimeout(()=>{rt=!1},500),it=t.length){let i="";for(var e=0;e<it;e++){let a=new SBUser(t[e],t[e].extra);i+=gt.getRow(a),tt[a.id]=a}et++,k.find("tbody").append(i),d(this)}x.find(" > .sb-loading-pagination").remove()}))}),t(T).on("click",".sb-delete",function(){a("This user will be deleted permanently including all linked data, conversations, and messages.","alert",function(){gt.delete(i().id)})}),t(k).on("click","td:not(:first-child)",function(){vt.show(t(this).parent().attr("data-user-id"))}),t(C).on("click",".sb-top-bar .sb-edit",function(){vt.showEdit(i())}),t(x).on("click",".sb-new-user",function(){T.addClass("sb-user-new"),T.find(".sb-top-bar .sb-profile span").html(o("Add new user")),T.find(".sb-top-bar .sb-save").html(`<i class="sb-icon-check"></i>${o("Add user")}`),T.find("#email input").prop("required",!0),T.find("input,select,textara").removeClass("sb-error"),"admin"==SB_ACTIVE_AGENT.user_type&&T.find("#user_type").find("select").html(`<option value="user">${o("User")}</option><option value="agent">${o("Agent")}</option><option value="admin">${o("Admin")}</option>`),vt.clear(T),vt.boxClasses(T),T.sbShowLightbox()}),t(T).on("click",".sb-save",function(){if(n(this))return;let a=!!T.hasClass("sb-user-new"),s=T.attr("data-user-id"),o=vt.getAll(T.find(".sb-details")),r=vt.getAll(T.find(".sb-additional-details"));if(vt.errors(T))return vt.showErrorMessage(T,["agent","admin"].includes(T.find("#user_type :selected").val())||T.hasClass("sb-user-new")?"First name, last name, and a valid email are required.":"First name and last name are required."),void t(this).sbLoading(!1);SBF.ajax({function:a?"add-user":"update-user",user_id:s,settings:o,settings_extra:r},n=>{if(SBF.errorValidation(n,"duplicate-email")||SBF.errorValidation(n,"duplicate-phone"))return vt.showErrorMessage(T,`This ${SBF.errorValidation(n,"duplicate-email")?"email":"phone number"} is already in use.`),void t(this).sbLoading(!1);a&&(s=n,i(new SBUser({id:s}))),i().update(()=>{tt[s]=i(),a?(vt.clear(T),gt.update()):(gt.updateRow(i()),b.sbActive()&&bt.updateUserDetails(),s==SB_ACTIVE_AGENT.id&&(SBF.loginCookie(n[1]),SB_ACTIVE_AGENT.full_name=i().name,SB_ACTIVE_AGENT.profile_image=i().image,g.find(".sb-account").setProfile())),t(this).sbLoading(!1),T.find(".sb-profile").setProfile(),e(a?"New user added":"User updated")}),SBF.event("SBUserUpdated",{new_user:a,user_id:s})})}),t(T).on("change","#user_type",function(){vt.boxClasses(T,t(this).find("option:selected").val())}),t(C).on("click",".sb-user-conversations li",function(){bt.open(t(this).attr("data-conversation-id"),i().id)}),t(C).on("click",".sb-start-conversation",function(){bt.open(-1,i().id),bt.openConversation(-1,i().id),at&&bt.mobileOpenConversation()}),t(C).on("click",".sb-top-bar [data-value]",function(){bt.showDirectMessageBox(t(this).attr("data-value"),[i().id])}),t(x).on("click",".sb-top-bar [data-value]",function(){let e=t(this).data("value"),i=[];switch(k.find("tr").each(function(){t(this).find('td input[type="checkbox"]').is(":checked")&&i.push(t(this).attr("data-user-id"))}),e){case"message":case"email":case"sms":bt.showDirectMessageBox(e,i);break;case"csv":gt.csv();break;case"delete":a("All selected users will be deleted permanently including all linked data, conversations, and messages.","alert",()=>{gt.delete(i),t(this).hide(),k.find("th:first-child input").prop("checked",!1)})}}),t(f).on("click",".sb-send-direct-message",function(){let i=B.attr("data-type"),a=B.find(".sb-direct-message-subject input").val(),s=B.find("textarea").val(),o=B.find(".sb-direct-message-users").val().replace(/ /g,"");if(SBForm.errors(B))SBForm.showErrorMessage(B,"All fields are required.");else{if(n(this))return;if("message"==i)SBF.ajax({function:"direct-message",user_ids:o,message:s},n=>{t(this).sbLoading(!1);let r=SB_ADMIN_SETTINGS["notify-user-email"],c=SB_ADMIN_SETTINGS["sms-active-users"];if(SBF.errorValidation(n))return SBForm.showErrorMessage(B,"An error has occurred. Please make sure all user ids are correct.");(r||c)&&SBF.ajax({function:"get-users-with-details",user_ids:o,details:r&&c?["email","phone"]:[r?"email":"phone"]},t=>{r&&t.email.length?l(t.email,s,0,c?t.phone:[],"email",a):c&&t.phone.length?l(t.phone,s,0,[],"sms"):f.sbHideLightbox()}),e(`${SBF.slugToString(i)} sent to all users.`)});else{let e="email"==i?"email":"phone";SBF.ajax({function:"get-users-with-details",user_ids:o,details:[e]},n=>{if(!n[e].length)return t(this).sbLoading(!1),SBForm.showErrorMessage(B,"No users found.");l(n[e],s,0,[],"email"==i?"custom-email":"sms",a)})}}}),SBF.getURL("setting")&&(g.find(".sb-admin-nav #sb-settings").click(),setTimeout(()=>{$.find("#tab-"+SBF.getURL("setting")).click()},300)),t($).on("click"," > .sb-tab > .sb-nav [id]",function(){let e=t(this).attr("id").substr(4);SBF.getURL("setting")!=e&&u("?setting="+e)}),t($).on("click",'[data-type="upload-image"] .image',function(){U=this,f.find(".sb-upload-form-admin .sb-upload-files").click()}),t($).on("click",'[data-type="upload-image"] .image > i',function(e){return t(this).parent().removeAttr("data-value").css("background-image",""),e.preventDefault(),!1}),t($).on("click",".sb-repeater-add",function(){ht.repeaterAdd(this)}),t($).on("click",".repeater-item > i",function(){ht.repeaterDelete(this)}),ht.initColorPicker(),t($).find('[data-type="color"]').focusout(function(){let e=t(this).closest(".input-color"),i=e.find("input").val();setTimeout(function(){e.find("input").val(""),e.find(".color-preview").css("background-color",i)},300),ht.set(t(this).attr("id"),i)}),t($).on("click",".sb-type-color .input i",function(e){t(this).parent().find("input").removeAttr("style").val("")}),t($).on("click",".sb-color-palette span",function(){let e=t(this).hasClass("sb-active");t(this).closest(".sb-repeater").find(".sb-active").sbActive(!1),t(this).sbActive(!e)}),t($).on("click",".sb-color-palette ul li",function(){t(this).parent().parent().attr("data-value",t(this).data("value")).find("span").sbActive(!1)}),t($).on("click",'[data-type="select-images"] .input > div',function(){t(this).siblings().sbActive(!1),t(this).sbActive(!0)}),t($).on("click",".sb-save-changes",function(){ht.save(this)}),t($).on("change",'#user-additional-fields [data-id="extra-field-slug"], #saved-replies [data-id="reply-name"], [data-id="rich-message-name"]',function(){t(this).val(SBF.stringToSlug(t(this).val()))}),t($).on("click","#timetable-utc input",function(){""==t(this).val()&&t(this).val(Math.round(ot.getTimezoneOffset()/60))}),t($).on("click","#dialogflow-button .sb-btn",function(t){let e=$.find("#google-client-id input").val();return e?window.open(`https://accounts.google.com/o/oauth2/auth?scope=https%3A%2F%2Fwww.googleapis.com/auth/dialogflow%20https%3A%2F%2Fwww.googleapis.com%2Fauth%2Fcloud-translation&response_type=code&access_type=offline&redirect_uri=${SB_URL}/include/google.php&client_id=${e}&prompt=consent`):window.open("https://board.support/synch/?service=dialogflow&plugin_url="+SB_URL+p()),t.preventDefault(),!1}),t($).on("click","#google-domain-information .sb-btn",function(t){return a(`Authorised JavaScript origins URI: ${SB_URL.substr(0,SB_URL.replace("//","").indexOf("/")+2)}<br><br>Authorised redirect URI: ${SB_URL}/include/google.php`,"info"),t.preventDefault(),!1}),t($).on("click","#test-email-user .sb-btn, #test-email-agent .sb-btn",function(){let e=t(this).parent().find("input").val();e&&e.indexOf("@")>0&&!n(this)&&SBF.ajax({function:"send-test-email",to:e,email_type:"test-email-user"==t(this).parent().parent().attr("id")?"user":"agent"},()=>{a("Email successfully sent. Check your emails!","info"),t(this).sbLoading(!1)})}),t($).on("click",".sb-timetable > div > div > div",function(){let e=t(this).closest(".sb-timetable"),i=t(this).sbActive();if(t(e).find(".sb-active").sbActive(!1),i)t(this).sbActive(!1).find(".sb-custom-select").remove();else{let i=t(e).find("> .sb-custom-select").html();t(e).find(" > div .sb-custom-select").remove(),t(this).append(`<div class="sb-custom-select">${i}</div>`).sbActive(!0)}}),t($).on("click",".sb-timetable .sb-custom-select span",function(){let e=[t(this).html(),t(this).attr("data-value")];t(this).closest(".sb-timetable").find("> div > div > .sb-active").html(e[0]).attr("data-value",e[1]),t(this).parent().sbActive(!1)}),t($).on("click","#system-requirements a",function(t){let e=f.find(".sb-requirements-box"),i="";return SBF.ajax({function:"system-requirements"},t=>{for(var a in t)i+=`<div class="sb-input"><span>${o(SBF.slugToString(a))}</span><div${t[a]?' class="sb-green"':""}>${o(t[a]?"Success":"Error")}</div></div>`;s(!1),e.find(".sb-main").html(i),e.sbShowLightbox()}),e.sbActive(!1),s(!0),t.preventDefault(),!1}),t($).on("click","#sb-path a",function(t){return SBF.ajax({function:"path"},t=>{a(t,"info")}),t.preventDefault(),!1}),t($).on("click","#delete-leads a",function(e){return t(this).sbLoading()||a("All leads, including all the linked conversations and messages, will be deleted permanently.","alert",()=>{t(this).sbLoading(!0),SBF.ajax({function:"delete-leads"},()=>{a("Leads and conversations successfully deleted.","info"),t(this).sbLoading(!1)})}),e.preventDefault(),!1}),t($).on("click","#dialogflow-smart-reply-generate a",function(e){if(!n(this))return SBF.ajax({function:"dialogflow-smart-reply-generate-conversations-data"},e=>{a("Conversations data successfully generated. Folder: "+e,"info"),t(this).sbLoading(!1)}),e.preventDefault(),!1}),t($).on("click","#sb-export-settings a",function(e){if(!n(this))return SBF.ajax({function:"export-settings"},e=>{window.open(e),a(`${o("For security reasons, delete the settings file after downloading it. Close this window to automatically delete it. File location:")}<pre>${e}</pre>`,"info",!1,"sb-export-settings-close","Settings exported"),t(this).sbLoading(!1)}),e.preventDefault(),!1}),t($).on("click","#sb-import-settings a",function(i){if(!n(this))return U=this,G=(i=>{SBF.ajax({function:"import-settings",file_url:i},i=>{i?e("Settings successfully imported. Reload the admin area to apply the new settings."):a(i,"info"),t(this).sbLoading(!1)}),G=!1}),f.find(".sb-upload-form-admin .sb-upload-files").click(),i.preventDefault(),!1}),t(f).on("click","#sb-export-settings-close .sb-close",function(){SBF.ajax({function:"delete-file",path:f.find(".sb-dialog-box p pre").html()})}),t($).on("click","#slack-test .sb-btn",()=>(window.open("https://board.support/synch/?service=slack&plugin_url="+SB_URL+p()),!1)),t($).on("click","#slack-test .sb-btn",function(e){if(!n(this))return SBF.ajax({function:"send-slack-message",user_id:-1,full_name:SB_ACTIVE_AGENT.full_name,profile_image:SB_ACTIVE_AGENT.profile_image,message:"Lorem ipsum dolor sit amete consectetur adipiscing elite incidido labore et dolore magna aliqua.",attachments:[["Example link",SB_URL+"/media/user.svg"],["Example link two",SB_URL+"/media/user.svg"]]},e=>{SBF.errorValidation(e)?"slack-not-active"==e[1]?a("Please first activate Slack, then save the settings and reload the admin area.","info"):a("Error. Response: "+JSON.stringify(e),"info"):a("success"==e[0]?"Slack message successfully sent. Check your Slack app!":JSON.stringify(e),"info"),t(this).sbLoading(!1)}),e.preventDefault(),!1}),t($).on("click","#tab-slack",function(){let t=$.find("#slack-agents .input");t.html('<div class="sb-loading"></div>'),SBF.ajax({function:"slack-users"},e=>{let i="";if(SBF.errorValidation(e,"slack-token-not-found"))i=`<p>${o("Synchronize Slack and save changes before linking agents.")}</p>`;else{let t='<option value="-1"></option>';for(a=0;a<e.agents.length;a++)t+=`<option value="${e.agents[a].id}">${e.agents[a].name}</option>`;for(var a=0;a<e.slack_users.length;a++)i+=`<div data-id="${e.slack_users[a].id}"><label>${e.slack_users[a].name}</label><select>${t}</select></div>`}t.html(i),ht.set("slack-agents",[e.saved,"double-select"])})}),t($).on("click","#slack-archive-channels .sb-btn",function(e){e.preventDefault(),n(this)||SBF.ajax({function:"archive-slack-channels"},e=>{!0===e&&a("Slack channels archived successfully!","info"),t(this).sbLoading(!1)})}),t($).on("click","#messenger-button .sb-btn",()=>(window.open("https://board.support/synch/?service=messenger&plugin_url="+SB_URL+p()),!1)),t($).on("click","#whatsapp-twilio-btn .sb-btn, #sms-btn .sb-btn, #wechat-btn .sb-btn",function(e){let i=t(this).closest("[id]").attr("id");return a(`<pre>${SB_URL+("sms-btn"==i?"/inlude/api.php":"wechat-btn"==i?"/apps/wechat/post.php":"/apps/whatsapp/post.php")+p().replace("&","?")}</pre>`,"info"),!1}),t($).on("click","#telegram-button .sb-btn",function(e){let i=$.find("#telegram-token input").val().trim();return e.preventDefault(),!(!i||n(this))&&(SBF.ajax({function:"telegram-synchronization",token:i,cloud_token:p()},()=>{a("Synchronization completed.","info"),t(this).sbLoading(!1)}),!1)}),t($).on("click","#wp-sync .sb-btn",function(e){return e.preventDefault(),!n(this)&&(pt.wordpress.ajax("wp-sync",{},e=>{!0===e||"1"===e?(gt.update(),a("WordPress users successfully imported.","info")):a("Error. Response: "+JSON.stringify(e),"info"),t(this).sbLoading(!1)}),!1)}),t("body").on("click","#wp-admin-bar-logout",function(){SBF.logout(!1)}),t($).on("click","#tab-translations",function(){let t=$.find(".sb-translations > .sb-nav > ul");if(""==t.html()){let i="";for(var e in SB_LANGUAGE_CODES)"en"!=e&&(i+=`<li data-code="${e}"><img src="${SB_URL}/media/flags/${e}.png" />${SB_LANGUAGE_CODES[e]}</li>`);t.html(i)}}),t($).on("click",".sb-translations .sb-nav li",function(){ht.translations.load(t(this).data("code"))}),t($).on("click",".sb-translations .sb-menu-wide li",function(){$.find(`.sb-translations [data-area="${t(this).data("value")}"]`).sbActive(!0).siblings().sbActive(!1)}),t($).on("click",".sb-add-translation",function(){$.find(".sb-translations-list > .sb-active").prepend(`<div class="sb-input-setting sb-type-text sb-new-translation"><input type="text" placeholder="${o("Enter original text...")}"><input type="text" placeholder="${o("Enter translation...")}"></div></div>`)}),t($).on("input",".sb-search-translation input",function(){let e=t(this).val().toLowerCase();SBF.search(e,()=>{e.length>1&&$.find(".sb-translations .sb-content > .sb-active label").each(function(){let i=t(this).html().toLowerCase();if(i.includes(e)&&i!=H){let e=$.find(".sb-scroll-area");return e[0].scrollTop=0,e[0].scrollTop=t(this).position().top-80,H=i,!1}})})}),t($).on("click","#tab-articles",function(){F.find(".sb-menu-wide li").eq(0).sbActive(!0).next().sbActive(!1),ht.articles.get(t=>{ht.articles.populate(t[0]),ht.articles.categories=t[1],ht.articles.translations=Array.isArray(t[2])&&!t[2].length?{}:t[2],ht.articles.updateSelect(),s(!1)},!0),s()}),t(F).on("click",'.sb-nav:not([data-type="categories"]) li',function(){ht.articles.show(t(this).attr("data-id"),this)}),t(F).on("click",".sb-add-article",function(){ht.articles.add()}),t(F).on("click",".sb-add-category",function(){ht.articles.addCategory(!1,"categories"==t(this).data("type"))}),t(F).on("click",".sb-nav i",function(){let e=t(this).hasClass("sb-category");a(`The ${e?"category":"article"} will be deleted permanently.`,"alert",()=>{ht.articles.delete(this,e)})}),t(F).on("click",".sb-menu-wide li",function(){ht.articles.populate(!1,"categories"==t(this).data("type"))}),t($).on("click","#email-piping-sync a",function(e){n(this)||(SBF.ajax({function:"email-piping",force:!0},e=>{a(!0===e?"Syncronization completed.":e,"info"),t(this).sbLoading(!1)}),e.preventDefault())}),t($).on("click","#tab-automations",function(){ht.automations.get(()=>{ht.automations.populate(),s(!1)},!0),s()}),t(E).on("click",".sb-add-condition",function(){ht.automations.addCondition()}),t(E).on("change",".sb-condition-1 select",function(){ht.automations.updateCondition(this)}),t(N).on("click","li",function(){ht.automations.populate(t(this).data("value"))}),t(M).on("click","li",function(){ht.automations.show(t(this).attr("data-id"))}),t(E).on("click",".sb-add-automation",function(){ht.automations.add()}),t(M).on("click","li i",function(){a("The automation will be deleted permanently.","alert",()=>{ht.automations.delete(this)})}),t(D).on("click",".sb-nav [id]",function(){let e=t(this).attr("id");ft.active_report=!1,D.find("#sb-date-picker").val(""),D.attr("class","sb-area-reports sb-active sb-report-"+e),ft.initReport(t(this).attr("id")),SBF.getURL("report")!=e&&u("?report="+e)}),t(D).on("change","#sb-date-picker",function(){ft.initReport(!1,t(this).val())}),SBF.getURL("report")&&(D.sbActive()||g.find(".sb-admin-nav #sb-reports").click(),setTimeout(()=>{D.find("#"+SBF.getURL("report")).click()},500)),t(b).on("click",".sb-panel-woocommerce > i",function(){pt.woocommerce.conversationPanel()}),t(b).on("click",".sb-woocommerce-orders > div > span",function(e){let i=t(this).parent();t(e.target).is("span")&&(i.sbActive()||pt.woocommerce.conversationPanelOrder(i.attr("data-id")))}),t(b).on("click",".sb-btn-woocommerce",function(){(K.sbLoading()||0!=i()&&i().language!=pt.woocommerce.popupLanguage)&&pt.woocommerce.popupPopulate(),Y.sbTogglePopup(this)}),t(Y).find(".sb-woocommerce-products-list").on("scroll",function(){d(this,!0)&&pt.woocommerce.popupPagination(this)}),t(Y).on("click",".sb-select li",function(){pt.woocommerce.popupFilter(this)}),t(Y).on("input",".sb-search-btn input",function(){pt.woocommerce.popupSearch(this)}),t(Y).on("click",".sb-search-btn i",function(){SBF.searchClear(this,()=>{pt.woocommerce.popupSearch(t(this).next())})}),t(Y).on("click",".sb-woocommerce-products-list li",function(){let e=Y.attr("data-action"),i=t(this).data("id");SBF.null(e)?SBChat.insertText(`{product_card id="${i}"}`):(K.sbLoading(!0),b.find(".sb-add-cart-btn").sbLoading(!0),SBChat.sendMessage(-1,"",[],t=>{t&&(pt.woocommerce.conversationPanelUpdate(i),f.sbHideLightbox())},{event:"woocommerce-update-cart",action:"cart-add",id:i})),SBF.deactivateAll(),f.removeClass("sb-popup-active")}),t(b).on("click",".sb-panel-woocommerce .sb-add-cart-btn",function(){t(this).sbLoading()||(SBChat.user_online?(pt.woocommerce.popupPopulate(),Y.sbShowLightbox(!0,"cart-add")):a("The user is offline. Only the carts of online users can be updated.","info"))}),t(b).on("click",".sb-panel-woocommerce .sb-list-items > a > i",function(e){let i=t(this).parent().attr("data-id");return SBChat.sendMessage(-1,"",[],()=>{pt.woocommerce.conversationPanelUpdate(i,"removed")},{event:"woocommerce-update-cart",action:"cart-remove",id:i}),t(this).sbLoading(!0),e.preventDefault(),!1}),t($).on("click","#wc-dialogflow-synch a, #wc-dialogflow-create-intents a",function(e){if(pt.is("dialogflow")){if(n(this))return;let e=t(this).parent().attr("id");SBF.ajax({function:"woocommerce-dialogflow-"+("wc-dialogflow-synch"==e?"entities":"intents")},e=>{t(this).sbLoading(!1),a(e?"Synchronization completed.":"Error. Something went wrong.","info")})}else a("This feature requires the Dialogflow App. Get it from the apps area.","info");return e.preventDefault(),!1}),t(b).on("click",".sb-panel-ump > i",function(){pt.ump.conversationPanel()}),t(b).on("click",".sb-panel-armember > i",function(){pt.armember.conversationPanel()}),t($).on("click","#perfex-sync .sb-btn, #whmcs-sync .sb-btn,#perfex-articles-sync .sb-btn, #whmcs-articles-sync .sb-btn, #aecommerce-sync .sb-btn, #aecommerce-sync-admins .sb-btn, #aecommerce-sync-sellers .sb-btn",function(e){if(n(this))return;let i=t(this).closest("[id]").attr("id"),s=i.indexOf("article")>0;SBF.ajax({function:i},e=>{!0===e?(s||gt.update(),a(s?"Knowledge base articles successfully imported.":"Users successfully imported.","info")):a("Error. Response: "+JSON.stringify(e),"info"),t(this).sbLoading(!1)}),e.preventDefault()}),t(f).on("click",".sb-language-switcher > i",function(){let e=t(this).parent(),i=e.find("[data-language]").map(function(){return t(this).attr("data-language")}).get(),a=f.find(".sb-languages-box"),s="";i.push("en");for(var n in SB_LANGUAGE_CODES)i.includes(n)||(s+=`<div data-language="${n}"><img src="${SB_URL}/media/flags/${n}.png" />${o(SB_LANGUAGE_CODES[n])}</div>`);j=e,a.attr("data-source",e.attr("data-source")),a.find(".sb-main").html(s),a.sbShowLightbox()}),t(f).on("click",".sb-language-switcher img",function(){let e=t(this).parent(),i=e.sbActive(),a=!i&&e.attr("data-language");switch(e.parent().attr("data-source")){case"articles":ht.articles.show(!1,!1,a);break;case"automations":ht.automations.show(!1,a);break;case"settings":let t=e.parent().find("[data-language].sb-active");ht.translations.save(e,i?e.attr("data-language"):!!t.length&&t.attr("data-language")),ht.translations.activate(e,a)}e.siblings().sbActive(!1),e.sbActive(!i)}),t(f).on("click",".sb-language-switcher span > i",function(){let e=t(this).parent(),i=e.attr("data-language");a(o("The {T} translation will be deleted.").replace("{T}",o(SB_LANGUAGE_CODES[i])),"alert",()=>{switch(e.parent().attr("data-source")){case"articles":ht.articles.deleteTranslation(!1,i),ht.articles.show();break;case"automations":ht.automations.deleteTranslation(!1,i),ht.automations.show();break;case"settings":ht.translations.delete(e,i)}e.remove()})}),t(f).on("click",".sb-languages-box [data-language]",function(){let e=t(this).parents().eq(1),i=t(this).attr("data-language");switch(e.attr("data-source")){case"articles":ht.articles.addTranslation(!1,i),ht.articles.show(!1,!1,i);break;case"automations":ht.automations.addTranslation(!1,!1,i),ht.automations.show(!1,i);break;case"settings":ht.translations.add(i)}f.sbHideLightbox()}),t(f).on("click",".sb-lightbox .sb-top-bar .sb-close",function(){f.sbHideLightbox()}),t(f).on("click",".sb-lightbox .sb-info",function(){t(this).sbActive(!1)}),t(f).on("click",".sb-dialog-box a",function(){let e=t(this).closest(".sb-lightbox");t(this).hasClass("sb-confirm")&&O(),1==f.find(".sb-lightbox.sb-active").length&&q.sbActive(!1),mt.open_popup=!1,e.sbActive(!1)}),t(f).on("click",".sb-menu-wide li, .sb-nav li",function(){t(this).siblings().sbActive(!1),t(this).sbActive(!0)}),t(f).on("click",".sb-nav:not(.sb-nav-only) li:not(.sb-tab-nav-title)",function(){let e=t(this).closest(".sb-tab"),i=t(e).find(" > .sb-content > div").sbActive(!1).eq(t(this).parent().find("li:not(.sb-tab-nav-title)").index(this));i.sbActive(!0),i.find("textarea").each(function(){t(this).autoExpandTextarea(),t(this).manualExpandTextarea()}),e.find(".sb-scroll-area").scrollTop(0)}),t(f).sbInitTooltips(),t(f).on("click",'[data-button="toggle"]',function(){let e=f.find("."+t(this).data("show")),i=f.find("."+t(this).data("hide"));e.addClass("sb-show-animation").show(),i.hide(),mt.open_popup=!(!e.hasClass("sb-lightbox")&&!e.hasClass("sb-popup"))&&e}),t(f).on("click",".sb-info-card",function(){t(this).sbActive(!1)}),t(f).on("change",".sb-upload-form-admin .sb-upload-files",function(e){t(this).sbUploadFiles(function(e){if("success"==(e=JSON.parse(e))[0]){"upload-image"==t(U).closest("[data-type]").data("type")&&t(U).attr("data-value",e[1]).css("background-image",`url("${e[1]}")`),G&&G(e[1])}else console.log(e[1])})}),t(f).on("click",".sb-accordion > div > span",function(e){let i=t(this).parent(),a=t(i).sbActive();t(e.target).is("span")&&(i.siblings().sbActive(!1),i.sbActive(!a))}),t(f).on("mousedown",function(e){if(t(mt.open_popup).length){let i=t(mt.open_popup);i.is(e.target)||0!==i.has(e.target).length||["sb-btn-saved-replies","sb-btn-emoji"].includes(t(e.target).attr("class"))||(i.hasClass("sb-popup")?i.sbTogglePopup():i.hasClass("sb-select")?i.find("ul").sbActive(!1):i.hasClass("sb-menu-mobile")?i.find("i").sbActive(!1):i.hasClass("sb-menu")?i.sbActive(!1):f.sbHideLightbox(),mt.open_popup=!1)}})));else{let e=f.find(".sb-intall");t(f).on("click",".sb-submit-installation",function(){if(n(this))return;let i=!1,a=e.find("#first-name").length;if(SBForm.errors(e))i=a?"All fields are required. Minimum password length is 8 characters. Be sure you've entered a valid email.":"All fields are required.";else if(a&&e.find("#password input").val()!=e.find("#password-check input").val())i="The passwords do not match.";else{let a=window.location.href.replace("/admin","").replace(".php","").replace(/#$|\/$/,"").replace(/#$|\/$/,"");a.includes("?")&&(a=a.substr(0,a.indexOf("?"))),t.ajax({method:"POST",url:a+"/include/ajax.php",data:{function:"installation",details:t.extend(SBForm.getAll(e),{url:a})}}).done(s=>{if(0!=(s=JSON.parse(s))){if(!0===(s=s[1]))return void setTimeout(()=>{window.location.href=a+"/admin.php?refresh=true"},1e3);switch(s){case"connection-error":i="Support Board cannot connect to the database. Please check the database information and try again.";break;case"missing-details":i="Missing database details! Please check the database information and try again.";break;case"missing-url":i="Support Board cannot get the plugin URL.";break;default:i=s}}else i=s;!1!==i&&(SBForm.showErrorMessage(e,i),t("html, body").animate({scrollTop:0},500)),t(this).sbLoading(!1)})}!1!==i&&(SBForm.showErrorMessage(e,i),t("html, body").animate({scrollTop:0},500),t(this).sbLoading(!1))})}})}(jQuery),function(t,e){"object"==typeof exports?module.exports=e(t):"function"==typeof define&&define.amd?define("colors",[],function(){return e(t)}):t.Colors=e(t)}(this,function(t,e){function i(t,i,s,n,o){if("string"==typeof i){s=(i=m.txt2color(i)).type,p[s]=i[s],o=o!==e?o:i.alpha}else if(i)for(var c in i)t[s][c]=r(i[c]/l[s][c][1],0,1);return o!==e&&(t.alpha=r(+o,0,1)),a(s,n?t:e)}function a(t,e){var i,a,r,h=e||p,f=m,g=u.options,b=l,v=h.RND,S="",_="",B={hsl:"hsv",rgb:t},y=v.rgb;if("alpha"!==t){for(var w in b)if(!b[w][w]){t!==w&&(_=B[w]||"rgb",h[w]=f[_+"2"+w](h[_])),v[w]||(v[w]={}),i=h[w];for(S in i)v[w][S]=d(i[S]*b[w][S][1])}y=v.rgb,h.HEX=f.RGB2HEX(y),h.equivalentGrey=g.grey.r*h.rgb.r+g.grey.g*h.rgb.g+g.grey.b*h.rgb.b,h.webSave=a=s(y,51),h.webSmart=r=s(y,17),h.saveColor=y.r===a.r&&y.g===a.g&&y.b===a.b?"web save":y.r===r.r&&y.g===r.g&&y.b===r.b?"web smart":"",h.hueRGB=m.hue2RGB(h.hsv.h),e&&(h.background=function(t,e,i){var a=u.options.grey,s={};return s.RGB={r:t.r,g:t.g,b:t.b},s.rgb={r:e.r,g:e.g,b:e.b},s.alpha=i,s.equivalentGrey=d(a.r*t.r+a.g*t.g+a.b*t.b),s.rgbaMixBlack=o(e,{r:0,g:0,b:0},i,1),s.rgbaMixWhite=o(e,{r:1,g:1,b:1},i,1),s.rgbaMixBlack.luminance=n(s.rgbaMixBlack,!0),s.rgbaMixWhite.luminance=n(s.rgbaMixWhite,!0),u.options.customBG&&(s.rgbaMixCustom=o(e,u.options.customBG,i,1),s.rgbaMixCustom.luminance=n(s.rgbaMixCustom,!0),u.options.customBG.luminance=n(u.options.customBG,!0)),s}(y,h.rgb,h.alpha))}var x,k,A,C=h.rgb,T=h.alpha,$="luminance",F=h.background;return x=o(C,{r:0,g:0,b:0},T,1),x[$]=n(x,!0),h.rgbaMixBlack=x,k=o(C,{r:1,g:1,b:1},T,1),k[$]=n(k,!0),h.rgbaMixWhite=k,g.customBG&&(A=o(C,F.rgbaMixCustom,T,1),A[$]=n(A,!0),A.WCAG2Ratio=function(t,e){var i=1;return i=t>=e?(t+.05)/(e+.05):(e+.05)/(t+.05),d(100*i)/100}(A[$],F.rgbaMixCustom[$]),h.rgbaMixBGMixCustom=A,A.luminanceDelta=c.abs(A[$]-F.rgbaMixCustom[$]),A.hueDelta=function(t,e,i){return(c.max(t.r-e.r,e.r-t.r)+c.max(t.g-e.g,e.g-t.g)+c.max(t.b-e.b,e.b-t.b))*(i?255:1)/765}(F.rgbaMixCustom,A,!0)),h.RGBLuminance=n(y),h.HUELuminance=n(h.hueRGB),g.convertCallback&&g.convertCallback(h,t),h}function s(t,e){var i={},a=0,s=e/2;for(var n in t)a=t[n]%e,i[n]=t[n]+(a>s?e-a:-a);return i}function n(t,e){for(var i=e?1:255,a=[t.r/i,t.g/i,t.b/i],s=u.options.luminance,n=a.length;n--;)a[n]=a[n]<=.03928?a[n]/12.92:c.pow((a[n]+.055)/1.055,2.4);return s.r*a[0]+s.g*a[1]+s.b*a[2]}function o(t,i,a,s){var n={},o=a!==e?a:1,r=s!==e?s:1,l=o+r*(1-o);for(var c in t)n[c]=(t[c]*o+i[c]*r*(1-o))/l;return n.a=l,n}function r(t,e,i){return t>i?i:e>t?e:t}var l={rgb:{r:[0,255],g:[0,255],b:[0,255]},hsv:{h:[0,360],s:[0,100],v:[0,100]},hsl:{h:[0,360],s:[0,100],l:[0,100]},alpha:{alpha:[0,1]},HEX:{HEX:[0,16777215]}},c=t.Math,d=c.round,u={},p={},h={r:.298954,g:.586434,b:.114612},f={r:.2126,g:.7152,b:.0722},g=function(t){this.colors={RND:{}},this.options={color:"rgba(0,0,0,0)",grey:h,luminance:f,valueRanges:l},b(this,t||{})},b=function(t,a){var s,n=t.options;v(t);for(var o in a)a[o]!==e&&(n[o]=a[o]);s=n.customBG,n.customBG="string"==typeof s?m.txt2color(s).rgb:s,p=i(t.colors,n.color,e,!0)},v=function(t){u!==t&&(u=t,p=t.colors)};g.prototype.setColor=function(t,s,n){return v(this),t?i(this.colors,t,s,e,n):(n!==e&&(this.colors.alpha=r(n,0,1)),a(s))},g.prototype.setCustomBackground=function(t){return v(this),this.options.customBG="string"==typeof t?m.txt2color(t).rgb:t,i(this.colors,e,"rgb")},g.prototype.saveAsBackground=function(){return v(this),i(this.colors,e,"rgb",!0)},g.prototype.toString=function(t,e){return m.color2text((t||"rgb").toLowerCase(),this.colors,e)};var m={txt2color:function(t){var e={},i=t.replace(/(?:#|\)|%)/g,"").split("("),a=(i[1]||"").split(/,\s*/),s=i[1]?i[0].substr(0,3):"rgb",n="";if(e.type=s,e[s]={},i[1])for(var o=3;o--;)n=s[o]||s.charAt(o),e[s][n]=+a[o]/l[s][n][1];else e.rgb=m.HEX2rgb(i[0]);return e.alpha=a[3]?+a[3]:1,e},color2text:function(t,e,i){var a=!1!==i&&d(100*e.alpha)/100,s="number"==typeof a&&!1!==i&&(i||1!==a),n=e.RND.rgb,o=e.RND.hsl,r="hex"===t&&s,l="hex"===t&&!r,c="rgb"===t||r?n.r+", "+n.g+", "+n.b:l?"#"+e.HEX:o.h+", "+o.s+"%, "+o.l+"%";return l?c:(r?"rgb":t)+(s?"a":"")+"("+c+(s?", "+a:"")+")"},RGB2HEX:function(t){return((t.r<16?"0":"")+t.r.toString(16)+(t.g<16?"0":"")+t.g.toString(16)+(t.b<16?"0":"")+t.b.toString(16)).toUpperCase()},HEX2rgb:function(t){return t=t.split(""),{r:+("0x"+t[0]+t[t[3]?1:0])/255,g:+("0x"+t[t[3]?2:1]+(t[3]||t[1]))/255,b:+("0x"+(t[4]||t[2])+(t[5]||t[2]))/255}},hue2RGB:function(t){var e=6*t,i=~~e%6,a=6===e?0:e-i;return{r:d(255*[1,1-a,0,0,a,1][i]),g:d(255*[a,1,1,1-a,0,0][i]),b:d(255*[0,0,a,1,1,1-a][i])}},rgb2hsv:function(t){var e,i,a,s=t.r,n=t.g,o=t.b,r=0;return o>n&&(n=o+(o=n,0),r=-1),i=o,n>s&&(s=n+(n=s,0),r=-2/6-r,i=c.min(n,o)),e=s-i,a=s?e/s:0,{h:1e-15>a?p&&p.hsl&&p.hsl.h||0:e?c.abs(r+(n-o)/(6*e)):0,s:s?e/s:p&&p.hsv&&p.hsv.s||0,v:s}},hsv2rgb:function(t){var e=6*t.h,i=t.s,a=t.v,s=~~e,n=e-s,o=a*(1-i),r=a*(1-n*i),l=a*(1-(1-n)*i),c=s%6;return{r:[a,r,o,o,l,a][c],g:[l,a,a,r,o,o][c],b:[o,o,l,a,a,r][c]}},hsv2hsl:function(t){var e=(2-t.s)*t.v,i=t.s*t.v;return i=t.s?1>e?e?i/e:0:i/(2-e):0,{h:t.h,s:t.v||i?i:p&&p.hsl&&p.hsl.s||0,l:e/2}},rgb2hsl:function(t,e){var i=m.rgb2hsv(t);return m.hsv2hsl(e?i:p.hsv=i)},hsl2rgb:function(t){var e=6*t.h,i=t.s,a=t.l,s=.5>a?a*(1+i):a+i-i*a,n=a+a-s,o=~~e,r=s*(s?(s-n)/s:0)*(e-o),l=n+r,c=s-r,d=o%6;return{r:[s,c,n,n,l,s][d],g:[l,s,s,c,n,n][d],b:[n,n,l,s,s,c][d]}}};return g}),function(t,e){"object"==typeof exports?module.exports=e(t,require("jquery"),require("colors")):"function"==typeof define&&define.amd?define(["jquery","colors"],function(i,a){return e(t,i,a)}):e(t,t.jQuery,t.Colors)}(this,function(t,e,i,a){function s(t){return t.value||t.getAttribute("value")||e(t).css("background-color")||"#FFF"}function n(t){return(t=t.originalEvent&&t.originalEvent.touches?t.originalEvent.touches[0]:t).originalEvent?t.originalEvent:t}function o(t){return e(t.find(f.doRender)[0]||t[0])}function r(i){var a=e(this),n=a.offset(),r=e(t),u=f.gap;i?(g=o(a),g._colorMode=g.data("colorMode"),p.$trigger=a,(b||l()).css(f.positionCallback.call(p,a)||{left:(b._left=n.left)-((b._left+=b._width-(r.scrollLeft()+r.width()))+u>0?b._left+u:0),top:(b._top=n.top+a.outerHeight())-((b._top+=b._height-(r.scrollTop()+r.height()))+u>0?b._top+u:0)}).show(f.animationSpeed,function(){!0!==i&&(B.toggle(!!f.opacity)._width=B.width(),m._width=m.width(),m._height=m.height(),v._height=v.height(),h.setColor(s(g[0])),d(!0))}).off(".tcp").on(A,".cp-xy-slider,.cp-z-slider,.cp-alpha",c)):p.$trigger&&e(b).hide(f.animationSpeed,function(){d(!1),p.$trigger=null}).off(".tcp")}function l(){return e("head")[f.cssPrepend?"prepend":"append"]('<style type="text/css" id="tinyColorPickerStyles">'+(f.css||I)+(f.cssAddon||"")+"</style>"),e(F).css({margin:f.margin}).appendTo("body").show(0,function(){p.$UI=b=e(this),T=f.GPU&&b.css("perspective")!==a,v=e(".cp-z-slider",this),m=e(".cp-xy-slider",this),S=e(".cp-xy-cursor",this),_=e(".cp-z-cursor",this),B=e(".cp-alpha",this),y=e(".cp-alpha-cursor",this),f.buildCallback.call(p,b),b.prepend("<div>").children().eq(0).css("width",b.children().eq(0).width()),b._width=this.offsetWidth,b._height=this.offsetHeight}).hide()}function c(t){var i=this.className.replace(/cp-(.*?)(?:\s*|$)/,"$1").replace("-","_");(t.button||t.which)>1||(t.preventDefault&&t.preventDefault(),t.returnValue=!1,g._offset=e(this).offset(),(i="xy_slider"===i?function(t){var e=n(t),i=e.pageX-g._offset.left,a=e.pageY-g._offset.top;h.setColor({s:i/m._width*100,v:100-a/m._height*100},"hsv")}:"z_slider"===i?function(t){var e=n(t).pageY-g._offset.top;h.setColor({h:360-e/v._height*360},"hsv")}:function(t){var e=(n(t).pageX-g._offset.left)/B._width;h.setColor({},"rgb",e)})(t),d(),w.on(C,function(){w.off(".tcp")}).on(k,function(t){i(t),d()}))}function d(t){var e=h.colors,i=e.hueRGB,s=(e.RND.rgb,e.RND.hsl,f.dark),n=f.light,o=h.toString(g._colorMode,f.forceAlpha),r=e.HUELuminance>.22?s:n,l=e.rgbaMixBlack.luminance>.22?s:n,c=(1-e.hsv.h)*v._height,d=e.hsv.s*m._width,p=(1-e.hsv.v)*m._height,b=e.alpha*B._width,w=T?"translate3d":"",x=g[0].value,k=g[0].hasAttribute("value")&&""===x&&t!==a;m._css={backgroundColor:"rgb("+i.r+","+i.g+","+i.b+")"},S._css={transform:w+"("+d+"px, "+p+"px, 0)",left:T?"":d,top:T?"":p,borderColor:e.RGBLuminance>.22?s:n},_._css={transform:w+"(0, "+c+"px, 0)",top:T?"":c,borderColor:"transparent "+r},B._css={backgroundColor:"#"+e.HEX},y._css={transform:w+"("+b+"px, 0, 0)",left:T?"":b,borderColor:l+" transparent"},g._css={backgroundColor:k?"":o,color:k?"":e.rgbaMixBGMixCustom.luminance>.22?s:n},g.text=k?"":x!==o?o:"",t!==a?u(t):$(u)}function u(t){m.css(m._css),S.css(S._css),_.css(_._css),B.css(B._css),y.css(y._css),f.doRender&&g.css(g._css),g.text&&g.val(g.text),f.renderCallback.call(p,g,"boolean"==typeof t?t:a)}var p,h,f,g,b,v,m,S,_,B,y,w=e(document),x=e(),k="touchmove.tcp mousemove.tcp pointermove.tcp",A="touchstart.tcp mousedown.tcp pointerdown.tcp",C="touchend.tcp mouseup.tcp pointerup.tcp",T=!1,$=t.requestAnimationFrame||t.webkitRequestAnimationFrame||function(t){t()},F='<div class="cp-color-picker"><div class="cp-z-slider"><div class="cp-z-cursor"></div></div><div class="cp-xy-slider"><div class="cp-white"></div><div class="cp-xy-cursor"></div></div><div class="cp-alpha"><div class="cp-alpha-cursor"></div></div></div>',I=".cp-color-picker{position:absolute;overflow:hidden;padding:6px 6px 0;background-color:#444;color:#bbb;font-family:Arial,Helvetica,sans-serif;font-size:12px;font-weight:400;cursor:default;border-radius:5px}.cp-color-picker>div{position:relative;overflow:hidden}.cp-xy-slider{float:left;height:128px;width:128px;margin-bottom:6px;background:linear-gradient(to right,#FFF,rgba(255,255,255,0))}.cp-white{height:100%;width:100%;background:linear-gradient(rgba(0,0,0,0),#000)}.cp-xy-cursor{position:absolute;top:0;width:10px;height:10px;margin:-5px;border:1px solid #fff;border-radius:100%;box-sizing:border-box}.cp-z-slider{float:right;margin-left:6px;height:128px;width:20px;background:linear-gradient(red 0,#f0f 17%,#00f 33%,#0ff 50%,#0f0 67%,#ff0 83%,red 100%)}.cp-z-cursor{position:absolute;margin-top:-4px;width:100%;border:4px solid #fff;border-color:transparent #fff;box-sizing:border-box}.cp-alpha{clear:both;width:100%;height:16px;margin:6px 0;background:linear-gradient(to right,#444,rgba(0,0,0,0))}.cp-alpha-cursor{position:absolute;margin-left:-4px;height:100%;border:4px solid #fff;border-color:#fff transparent;box-sizing:border-box}",L=function(t){h=this.color=new i(t),f=h.options,p=this};L.prototype={render:d,toggle:r},e.fn.colorPicker=function(i){var a=this,n=function(){};return i=e.extend({animationSpeed:150,GPU:!0,doRender:!0,customBG:"#FFF",opacity:!0,renderCallback:n,buildCallback:n,positionCallback:n,body:document.body,scrollResize:!0,gap:4,dark:"#222",light:"#DDD"},i),!p&&i.scrollResize&&e(t).on("resize.tcp scroll.tcp",function(){p.$trigger&&p.toggle.call(p.$trigger[0],!0)}),x=x.add(this),this.colorPicker=p||new L(i),this.options=i,e(i.body).off(".tcp").on(A,function(t){-1===x.add(b).add(e(b).find(t.target)).index(t.target)&&r()}),this.on("focusin.tcp click.tcp",function(t){p.color.options=e.extend(p.color.options,f=a.options),r.call(this,t)}).on("change.tcp",function(){h.setColor(this.value||"#FFF"),a.colorPicker.render(!0)}).each(function(){var t=s(this),a=t.split("("),n=o(e(this));n.data("colorMode",a[1]?a[0].substr(0,3):"HEX").attr("readonly",f.preventFocus),i.doRender&&n.css({"background-color":t,color:function(){return h.setColor(t).rgbaMixBGMixCustom.luminance>.22?i.dark:i.light}})})},e.fn.colorPicker.destroy=function(){e("*").off(".tcp"),p.toggle(!1),x=e()}});